(function(){var re,X,P=window.jQuery,Te="mathquill-command-id",z="mathquill-block-id",J=Math.min,ke=Math.max;if(re=!1,!P)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";function L(){}var he=[].slice;function pe(e){var i=e.length-1;return function(){var t=he.call(arguments,0,i),n=he.call(arguments,i);return e.apply(this,t.concat([n]))}}var Ue=pe(function(e,i){return pe(function(t,n){if(e in t)return t[e].apply(t,i.concat(n))})});function fe(e){return pe(function(i,t){return typeof i!="function"&&(i=Ue(i)),e.call(this,function(n){return i.apply(n,[n].concat(t))})})}function h(e){var i=he.call(arguments,1);return function(){return e.apply(this,i)}}var d=function(e,i,t){function n(o){return typeof o=="object"}function s(o){return typeof o=="function"}function a(){}return function o(c,l){function p(){var v=new m;return s(v.init)&&v.init.apply(v,arguments),v}function m(){}l===void 0&&(l=c,c=Object),p.Bare=m;var q,w=a[e]=c[e],b=m[e]=p[e]=p.p=new a;return b.constructor=p,p.extend=function(v){return o(p,v)},(p.open=function(v){if(q={},s(v)?q=v.call(p,b,w,p,c):n(v)&&(q=v),n(q))for(var y in q)i.call(q,y)&&(b[y]=q[y]);return s(b.init)||(b.init=c),p})(l)}}("prototype",{}.hasOwnProperty),u=-1,O=d(P,function(e){e.insDirOf=function(i,t){return i===u?this.insertBefore(t.first()):this.insertAfter(t.last())},e.insAtDirEnd=function(i,t){return i===u?this.prependTo(t):this.appendTo(t)}}),M=d(function(e){e.parent=0,e[u]=0,e[1]=0,e.init=function(i,t,n){this.parent=i,this[u]=t,this[1]=n},this.copy=function(i){return M(i.parent,i[u],i[1])}}),I=d(function(e){e[u]=0,e[1]=0,e.parent=0;var i=0;this.byId={},e.init=function(){this.id=i+=1,I.byId[this.id]=this,this.ends={},this.ends[u]=0,this.ends[1]=0},e.dispose=function(){delete I.byId[this.id]},e.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},e.jQ=O(),e.jQadd=function(t){return this.jQ=this.jQ.add(t)},e.jQize=function(t){t=O(t||this.html());function n(a){if(a.getAttribute){var o=a.getAttribute("mathquill-command-id"),c=a.getAttribute("mathquill-block-id");o&&I.byId[o].jQadd(a),c&&I.byId[c].jQadd(a)}for(a=a.firstChild;a;a=a.nextSibling)n(a)}for(var s=0;s<t.length;s+=1)n(t[s]);return t},e.createDir=function(t,n){var s=this;return s.jQize(),s.jQ.insDirOf(t,n.jQ),n[t]=s.adopt(n.parent,n[u],n[1]),s},e.createLeftOf=function(t){return this.createDir(u,t)},e.selectChildren=function(t,n){return Oe(t,n)},e.bubble=fe(function(t){for(var n=this;n&&t(n)!==!1;n=n.parent);return this}),e.postOrder=fe(function(t){return function n(s){s.eachChild(n),t(s)}(this),this}),e.isEmpty=function(){return this.ends[u]===0&&this.ends[1]===0},e.isStyleBlock=function(){return!1},e.children=function(){return D(this.ends[u],this.ends[1])},e.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},e.foldChildren=function(t,n){return this.children().fold(t,n)},e.withDirAdopt=function(t,n,s,a){return D(this,this).withDirAdopt(t,n,s,a),this},e.adopt=function(t,n,s){return D(this,this).adopt(t,n,s),this},e.disown=function(){return D(this,this).disown(),this},e.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}});function de(e,i,t){i?i[1]===t&&i.parent:e.ends[u],t?t[u]===i&&t.parent:e.ends[1]}var D=d(function(e){e.init=function(i,t,n){if(n===X&&(n=u),this.ends={},i){i.parent,t.parent,this.ends[n]=i,this.ends[-n]=t;var s=this.fold([],function(a,o){return a.push.apply(a,o.jQ.get()),a});this.jQ=this.jQ.add(s)}},e.jQ=O(),e.withDirAdopt=function(i,t,n,s){return i===u?this.adopt(t,n,s):this.adopt(t,s,n)},e.adopt=function(i,t,n){de(i,t,n);var s=this;s.disowned=!1;var a=s.ends[u];if(!a)return this;var o=s.ends[1];return t||(i.ends[u]=a),n?n[u]=o:i.ends[1]=o,s.ends[1][1]=n,s.each(function(c){c[u]=t,c.parent=i,t&&(t[1]=c),t=c}),s},e.disown=function(){var i=this,t=i.ends[u];if(!t||i.disowned)return i;i.disowned=!0;var n=i.ends[1],s=t.parent;return de(s,t[u],t),de(s,n,n[1]),t[u]?t[u][1]=n[1]:s.ends[u]=n[1],n[1]?n[1][u]=t[u]:s.ends[1]=t[u],i},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=fe(function(i){var t=this,n=t.ends[u];if(!n)return t;for(;n!==t.ends[1][1]&&i(n)!==!1;n=n[1]);return t}),e.fold=function(i,t){return this.each(function(n){i=t.call(this,i,n)}),i}}),r={},Y={},He=d(M,function(e){e.init=function(i,t){this.parent=i,this.options=t;var n=this.jQ=this._jQ=O('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},e.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[1]?this.selection&&this.selection.ends[u][u]===this[u]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[1].jQ.first()):this.jQ.appendTo(this.parent.jQ),P(".math-area").css("background-color")=="rgb(0, 0, 0)"?P(this.jQ).css("border-color","#ffffff"):P(this.jQ).css("border-color","#000000"),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},e.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=O(),this},e.withDirInsertAt=function(i,t,n,s){var a=this.parent;this.parent=t,this[i]=n,this[-i]=s,a!==t&&a.blur&&a.blur(this)},e.insDirOf=function(i,t){return this.jQ.insDirOf(i,t.jQ),this.withDirInsertAt(i,t.parent,t[i],t),this.parent.jQ.addClass("mq-hasCursor"),this.setCursorHandle(this.parent),this},e.insLeftOf=function(i){return this.insDirOf(u,i)},e.insRightOf=function(i){return this.insDirOf(1,i)},e.insAtDirEnd=function(i,t){return this.jQ.insAtDirEnd(i,t.jQ),this.withDirInsertAt(i,t,0,t.ends[i]),t.focus(),this.setCursorHandle(t),this},e.insAtLeftEnd=function(i){return this.insAtDirEnd(u,i)},e.insAtRightEnd=function(i){return this.insAtDirEnd(1,i)},e.setCursorHandle=function(i){let t=n=>{n.parent?t(n.parent):n.controller.handle("cursor")};t(i)},e.jumpUpDown=function(i,t){var n=this;n.upDownCache[i.id]=M.copy(n);var s=n.upDownCache[t.id];if(s)s[1]?n.insLeftOf(s[1]):n.insAtRightEnd(s.parent);else{var a=n.offset().left;t.seek(a,n)}},e.offset=function(){var i=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),i},e.unwrapGramp=function(){var i=this.parent.parent,t=i.parent,n=i[1],s=i[u];if(i.disown().eachChild(function(a){a.isEmpty()||(a.children().adopt(t,s,n).each(function(o){o.jQ.insertBefore(i.jQ.first())}),s=a.ends[1])}),!this[1])if(this[u])this[1]=this[u][1];else for(;!this[1];){if(this.parent=this.parent[1],!this.parent){this[1]=i[1],this.parent=t;break}this[1]=this.parent.ends[u]}this[1]?this.insLeftOf(this[1]):this.insAtRightEnd(t),i.jQ.remove(),i[u].siblingDeleted&&i[u].siblingDeleted(this.options,1),i[1].siblingDeleted&&i[1].siblingDeleted(this.options,u)},e.startSelection=function(){for(var i=this.anticursor=M.copy(this),t=i.ancestors={},n=i;n.parent;n=n.parent)t[n.parent.id]=n},e.endSelection=function(){delete this.anticursor},e.select=function(){var i=this.anticursor;if(this[u]===i[u]&&this.parent===i.parent)return!1;for(var t=this;t.parent;t=t.parent)if(t.parent.id in i.ancestors){var n=t.parent;break}var s,a,o=i.ancestors[n.id],c=1;if(t[u]!==o){for(var l=t;l;l=l[1])if(l[1]===o[1]){c=u,s=t,a=o;break}}return c===1&&(s=o,a=t),s instanceof M&&(s=s[1]),a instanceof M&&(a=a[u]),this.hide().selection=n.selectChildren(s,a),this.selection.ends[c]&&this.insDirOf(c,this.selection.ends[c]),this.selectionChanged(),!0},e.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},e.deleteSelection=function(){this.selection&&(this[u]=this.selection.ends[u][u],this[1]=this.selection.ends[1][1],this.selection.remove(),this.selectionChanged(),delete this.selection)},e.replaceSelection=function(){var i=this.selection;return i&&(this[u]=i.ends[u][u],this[1]=i.ends[1][1],delete this.selection),i}}),Oe=d(D,function(e,i){e.init=function(){i.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},e.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),i.adopt.apply(this,arguments)},e.clear=function(){return this.jQ[0]&&this.jQ.replaceWith(this.jQ[0].childNodes),this},e.join=function(t){return this.fold("",function(n,s){return n+s[t]()})}}),R=d(function(e){e.init=function(t,n,s){this.id=t.id,this.data={},this.root=t,this.container=n,this.options=s,t.controller=this,this.cursor=t.cursor=He(t,s)},e.handle=function(t,n){var s=this.options.handlers;if(s&&s.fns[t]){var a=s.APIClasses[this.KIND_OF_MQ](this);n===u||n===1?s.fns[t](n,a):s.fns[t](a)}};var i=[];this.onNotify=function(t){i.push(t)},e.notify=function(){for(var t=0;t<i.length;t+=1)i[t].apply(this.cursor,arguments);return this}}),Z={},U=d(),ie={},Se=d(),je={};function me(){window.console&&console.warn(`You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:

    MathQuill = MathQuill.getInterface(1);
    // now MathQuill.MathField() works like it used to

`)}function E(e){return me(),ye(e)}E.prototype=Se.p,E.VERSION="v0.10.1",E.interfaceVersion=function(e){if(e!==1)throw"Only interface version 1 supported. You specified: "+e;return(me=function(){window.console&&console.warn(`You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:

    MathQuill = MathQuill.getInterface(1);
    // now MathQuill.MathField() works like it used to

`)})(),E},E.getInterface=ae,E.isSelectedItalic=!0;var Qe=ae.MIN=1,Ce=ae.MAX=2;function ae(e){if(!(Qe<=e&&e<=Ce))throw"Only interface versions between "+Qe+" and "+Ce+" supported. You specified: "+e;function i(o){if(!o||!o.nodeType)return null;var c=O(o).children(".mq-root-block").attr(z),l=c&&I.byId[c].controller;return l?t[l.KIND_OF_MQ](l):null}var t={};function n(o,c){for(var l in c&&c.handlers&&(c.handlers={fns:c.handlers,APIClasses:t}),c)if(c.hasOwnProperty(l)){var p=c[l],m=ie[l];o[l]=m?m(p):p}}i.L=u,i.R=1,i.saneKeyboardEvents=Ee,i.config=function(o){return n(U.p,o),this},i.registerEmbed=function(o,c){if(!/^[a-z][a-z0-9]*$/i.test(o))throw"Embed name must start with letter and be only letters and digits";je[o]=c};var s=t.AbstractMathQuill=d(Se,function(o){o.init=function(c){this.__controller=c,this.__options=c.options,this.id=c.id,this.data=c.data},o.__mathquillify=function(c){var l=this.__controller,p=l.root,m=l.container;l.createTextarea();var q=m.addClass(c).contents().detach();p.jQ=O('<span class="mq-root-block"/>').attr(z,p.id).appendTo(m),this.latex(q.text()),this.revert=function(){return m.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(q)}},o.config=function(c){return n(this.__options,c),this},o.el=function(){return this.__controller.container[0]},o.text=function(){return this.__controller.exportText()},o.latex=function(c){return arguments.length>0?(this.__controller.renderLatexMath(c),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},o.positionFix=function(c){if(this.__controller.textarea.focus(),c!=null&&c!=0)for(var l=Math.abs(c),p=0;p<l;p++)c>0?this.__controller.moveRight():this.__controller.moveLeft()},o.positionFiy=function(c){if(this.__controller.textarea.focus(),c!=null&&c!=0)for(var l=Math.abs(c),p=0;p<l;p++)c>0?this.__controller.moveUp():this.__controller.moveDown()},o.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},o.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});for(var a in i.prototype=s.prototype,t.EditableField=d(s,function(o,c){o.__mathquillify=function(){return c.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},o.focus=function(){return this.__controller.textarea.focus(),this},o.blur=function(){return this.__controller.textarea.blur(),this},o.write=function(l){if(!(window.$currentJQ.hasClass("mq-text-mode")&&l.length>1))return this.__controller.writeLatex(l),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},o.empty=function(){var l=this.__controller.root,p=this.__controller.cursor;return l.eachChild("postOrder","dispose"),l.ends[u]=l.ends[1]=0,l.jQ.empty(),delete p.selection,p.insAtRightEnd(l),this},o.cmd=function(l){var p=this.__controller.notify(),m=p.cursor;if(/^\\[a-z]+\{\}$/i.test(l)){l=l.slice(1);var q=r[l];q&&(l=q(l),m.selection&&l.replaces(m.replaceSelection()),l.createLeftOf(m.show()),this.__controller.scrollHoriz())}else m.parent.write(m,l);return p.blurred&&m.hide().parent.blur(),this},o.select=function(){var l=this.__controller;for(l.notify("move").cursor.insAtRightEnd(l.root);l.cursor[u];)l.selectLeft();return this},o.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},o.moveToDirEnd=function(l){return this.__controller.notify("move").cursor.insAtDirEnd(l,this.__controller.root),this},o.moveToLeftEnd=function(){return this.moveToDirEnd(u)},o.moveToRightEnd=function(){return this.moveToDirEnd(1)},o.keystroke=function(l){l=l.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var p=0;p<l.length;p+=1)this.__controller.keystroke(l[p],{preventDefault:L});return this},o.typedText=function(l){for(var p=0;p<l.length;p+=1)this.__controller.typedText(l.charAt(p));return this},o.dropEmbedded=function(l,p,m){var q=l-O(window).scrollLeft(),w=p-O(window).scrollTop(),b=document.elementFromPoint(q,w);this.__controller.seek(O(b),l,p),st().setOptions(m).createLeftOf(this.__controller.cursor)},o.clickAt=function(l,p,m){m=m||document.elementFromPoint(l,p);var q=this.__controller,w=q.root;return P.contains(w.jQ[0],m)||(m=w.jQ[0]),q.seek(O(m),l+pageXOffset,p+pageYOffset),q.blurred&&this.focus(),this},o.ignoreNextMousedown=function(l){return this.__controller.cursor.options.ignoreNextMousedown=l,this}}),i.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},i.EditableField.prototype=t.EditableField.prototype,Z)(function(o,c){var l=t[o]=c(t);i[o]=function(p,m){var q=i(p);if(q instanceof l||!p||!p.nodeType)return q;var w=R(l.RootBlock(),O(p),U());return w.KIND_OF_MQ=o,l(w).__mathquillify(m,e)},i[o].prototype=l.prototype})(a,Z[a]);return i}E.noConflict=function(){return window.MathQuill=Ve,E};var Ve=window.MathQuill;function _e(e){for(var i="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),t=0;t<i.length;t+=1)(function(n){e[n]=function(s){this.controller.handle(n,s)}})(i[t]);e.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}window.MathQuill=E;var De,x=d(function(e,i,t){function n(c,l){throw"Parse Error: "+l+" at "+(c=c?"'"+c+"'":"EOF")}e.init=function(c){this._=c},e.parse=function(c){return this.skip(o)._(""+c,function(l,p){return p},n)},e.or=function(c){var l=this;return t(function(p,m,q){return l._(p,m,function(w){return c._(p,m,q)})})},e.then=function(c){var l=this;return t(function(p,m,q){return l._(p,function(w,b){var v=c instanceof t?c:c(b);return v._(w,m,q)},q)})},e.many=function(){var c=this;return t(function(l,p,m){for(var q=[];c._(l,w,b););return p(l,q);function w(v,y){return l=v,q.push(y),!0}function b(){return!1}})},e.times=function(c,l){arguments.length<2&&(l=c);var p=this;return t(function(m,q,w){for(var b,v=[],y=!0,k=0;k<c;k+=1)if(!(y=p._(m,S,A)))return w(m,b);for(;k<l&&y;k+=1)y=p._(m,S,at);return q(m,v);function S(ce,ue){return v.push(ue),m=ce,!0}function A(ce,ue){return b=ue,m=ce,!1}function at(ce,ue){return!1}})},e.result=function(c){return this.then(a(c))},e.atMost=function(c){return this.times(0,c)},e.atLeast=function(c){var l=this;return l.times(c).then(function(p){return l.many().map(function(m){return p.concat(m)})})},e.map=function(c){return this.then(function(l){return a(c(l))})},e.skip=function(c){return this.then(function(l){return c.result(l)})},this.string=function(c){var l=c.length,p="expected '"+c+"'";return t(function(m,q,w){var b=m.slice(0,l);return b===c?q(m.slice(l),b):w(m,p)})};var s=this.regex=function(c){c.toString().charAt(1);var l="expected "+c;return t(function(p,m,q){var w=c.exec(p);if(w){var b=w[0];return m(p.slice(b.length),b)}return q(p,l)})},a=t.succeed=function(c){return t(function(l,p){return p(l,c)})},o=(t.fail=function(c){return t(function(l,p,m){return m(l,c)})},t.letter=s(/^[a-z]/i),t.letters=s(/^[a-z]*/i),t.digit=s(/^[0-9]/),t.digits=s(/^[0-9]*/),t.whitespace=s(/^\s+/),t.optWhitespace=s(/^\s*/),t.any=t(function(c,l,p){return c?l(c.slice(1),c.charAt(0)):p(c,"expected any character")}),t.all=t(function(c,l,p){return l("",c)}),t.eof=t(function(c,l,p){return c?p(c,"expected EOF"):l(c,c)}))}),Ee=(De={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},function(e,i){var t,n=null,s=null,a=P(e),o=P(i.container||a),c=L;function l(v){c=v,clearTimeout(t),t=setTimeout(v)}function p(v){l(function(y){c=L,clearTimeout(t),v(y)})}o.bind("keydown keypress input keyup focusout paste",function(v){c(v)});var m=!1;function q(){i.keystroke(function(v){var y,k=v.which||v.keyCode,S=De[k],A=[];return v.ctrlKey&&A.push("Ctrl"),v.originalEvent&&v.originalEvent.metaKey&&A.push("Meta"),v.altKey&&A.push("Alt"),v.shiftKey&&A.push("Shift"),y=S||String.fromCharCode(k),A.length||S?(A.push(y),A.join("-")):y}(n),n)}function w(){var v;if((!("selectionStart"in(v=a[0]))||v.selectionStart===v.selectionEnd)&&!re){var y=a.val();window.$currentJQ.hasClass("mq-text-mode")&&y.match(/[\u4e00-\u9fa5|\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3010|\u3011|\u007e｜\\]+/g)?a.val(""):y.length>1?(a.val(""),i.paste(y)):y.length===1?(a.val(""),i.typedText(y)):y&&a[0].select&&a[0].select();var k=i.notify().cursor.parent;k.isEmpty()?k.jQ.addClass("mq-outLine"):k.jQ.removeClass("mq-outLine")}}function b(){var v=a.val();a.val(""),v&&i.paste(v)}return l(w),o.bind({keydown:function(v){n=v,s=null,m&&p(function(y){y&&y.type==="focusout"||!a[0].select||a[0].select()}),q()},keypress:function(v){n&&s&&q(),s=v,l(w)},keyup:function(v){n&&!s&&l(w)},focusout:function(){n=s=null},compositionstart:function(v){re=!0},compositionend:function(v){var y=a.val()||v.originalEvent.data;const k=window.$currentJQ.hasClass("mq-text-mode");a.val(""),!k&&i.paste(y),re=!1},cut:function(){p(function(){i.cut()})},copy:function(){p(function(){i.copy()})},paste:function(v){a.focus(),l(b)}}),{select:function(v){c(),c=L,clearTimeout(t),a.val(v),v&&a[0].select&&a[0].select(),m=!!v}}});R.open(function(e,i){e.exportText=function(){return this.root.foldChildren("",function(t,n){return t+n.text()})}}),R.open(function(e){e.focusBlurEvents=function(){var i,t=this,n=t.root,s=t.cursor;function a(){clearTimeout(i),s.selection&&s.selection.jQ.addClass("mq-blur"),o()}function o(){s.hide().parent.blur(),t.container.removeClass("mq-focused"),O(window).unbind("blur",a)}t.textarea.focus(function(){t.blurred=!1,clearTimeout(i),t.container.addClass("mq-focused"),s.parent||s.insAtRightEnd(n),s.selection?(s.selection.jQ.removeClass("mq-blur"),t.selectionChanged()):s.show()}).blur(function(){t.blurred=!0,i=setTimeout(function(){n.postOrder("intentionalBlur"),o()}),O(window).bind("blur",a)}),t.blurred=!0,s.hide().parent.blur()}}),R.open(function(e){e.keystroke=function(i,t){this.cursor.parent.keystroke(i,t,this)}}),I.open(function(e){e.keystroke=function(i,t,n){var s=n.cursor;switch(i){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(u);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(1,i,t);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(u,i,t);case"End":n.notify("move").cursor.insAtRightEnd(s.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;s[1];)n.selectRight();break;case"Ctrl-Shift-End":for(;s[1]||s.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(s.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;s[u];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;s[u]||s.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(s[u])for(;s[u];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(s[1])for(;s[1];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(1);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);s[u];)n.selectLeft();break;default:return}t.preventDefault(),n.scrollHoriz()},e.moveOutOf=e.moveTowards=e.deleteOutOf=e.deleteTowards=e.unselectInto=e.selectOutOf=e.selectTowards=function(){}}),R.open(function(e){function i(t,n){var s=t.notify("upDown").cursor,a=n+"Into",o=n+"OutOf";return s[1][a]?s.insAtLeftEnd(s[1][a]):s[u][a]?s.insAtRightEnd(s[u][a]):s.parent.bubble(function(c){var l=c[o];if(l&&(typeof l=="function"&&(l=c[o](s)),l instanceof I&&s.jumpUpDown(c,l),l!==!0))return!1}),t}this.onNotify(function(t){t!=="move"&&t!=="upDown"||this.show().clearSelection()}),e.escapeDir=function(t,n,s){var a=this.cursor;if(a.parent!==this.root&&s.preventDefault(),a.parent!==this.root)return a.parent.moveOutOf(t,a),this.notify("move")},ie.leftRightIntoCmdGoes=function(t){if(t&&t!=="up"&&t!=="down")throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},e.moveDir=function(t){var n=this.cursor,s=n.options.leftRightIntoCmdGoes;return n.selection?n.insDirOf(t,n.selection.ends[t]):n[t]?n[t].moveTowards(t,n,s):n.parent.moveOutOf(t,n,s),this.notify("move")},e.moveLeft=function(){return this.moveDir(u)},e.moveRight=function(){return this.moveDir(1)},e.moveUp=function(){return i(this,"up")},e.moveDown=function(){return i(this,"down")},this.onNotify(function(t){t!=="upDown"&&(this.upDownCache={})}),this.onNotify(function(t){t==="edit"&&this.show().deleteSelection()}),e.deleteDir=function(t){var n=this.cursor,s=n.selection;return this.notify("edit"),s||(n[t]?n[t].deleteTowards(t,n):n.parent.deleteOutOf(t,n)),n[u].siblingDeleted&&n[u].siblingDeleted(n.options,1),n[1].siblingDeleted&&n[1].siblingDeleted(n.options,u),n.parent.bubble("reflow"),this},e.ctrlDeleteDir=function(t){var n=this.cursor;return!n[t]||n.selection?this.deleteDir(t):(this.notify("edit"),t===u?D(n.parent.ends[u],n[u]).remove():D(n[1],n.parent.ends[1]).remove(),n.insAtDirEnd(t,n.parent),n[u].siblingDeleted&&n[u].siblingDeleted(n.options,1),n[1].siblingDeleted&&n[1].siblingDeleted(n.options,u),n.parent.bubble("reflow"),this)},e.backspace=function(){return this.deleteDir(u)},e.deleteForward=function(){return this.deleteDir(1)},this.onNotify(function(t){t!=="select"&&this.endSelection()}),e.selectDir=function(t){var n=this.notify("select").cursor,s=n.selection;n.anticursor||n.startSelection();var a=n[t];a?s&&s.ends[t]===a&&n.anticursor[-t]!==a?a.unselectInto(t,n):a.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},e.selectLeft=function(){return this.selectDir(u)},e.selectRight=function(){return this.selectDir(1)}});var j=function(){function e(k){for(var S=k[0]||Q(),A=1;A<k.length;A+=1)k[A].children().adopt(S,S.ends[1],0);return S}var i=x.string,t=x.regex,n=x.letter,s=x.any,a=x.optWhitespace,o=x.succeed,c=x.fail,l=n.map(function(k){return N(k)}),p=t(/^[^${}\\_^]/).map(function(k){return f(k)}),m=t(/^[^\\a-eg-zA-Z]/).or(i("\\").then(t(/^[a-z]+/i).or(t(/^\s+/).result(" ")).or(s))).then(function(k){var S=r[k];return S?S(k).parser():c("unknown command: \\"+k)}).or(l).or(p),q=i("{").then(function(){return b}).skip(i("}")),w=a.then(q.or(m.map(function(k){var S=Q();return k.adopt(S,0,0),S}))),b=w.many().map(e).skip(a),v=i("[").then(w.then(function(k){return k.join("latex")!=="]"?o(k):c()}).many().map(e).skip(a)).skip(i("]")),y=b;return y.block=w,y.optBlock=v,y}();R.open(function(e,i){e.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},e.writeLatex=function(t){var n=this.notify("edit").cursor,s=x.all,a=x.eof,o=j.skip(a).or(s.result(!1)).parse(t);return o&&!o.isEmpty()&&(o.children().adopt(n.parent,n[u],n[1]),o.jQize().insertBefore(n.jQ),n[u]=o.ends[1],o.finalizeInsert(n.options,n),o.ends[1][1].siblingCreated&&o.ends[1][1].siblingCreated(n.options,u),o.ends[u][u].siblingCreated&&o.ends[u][u].siblingCreated(n.options,1),n.parent.bubble("reflow")),this},e.renderLatexMath=function(t){var n=this.root,s=this.cursor,a=x.all,o=x.eof,c=j.skip(o).or(a.result(!1)).parse(t);n.eachChild("postOrder","dispose"),n.ends[u]=n.ends[1]=0,c&&c.children().adopt(n,0,0);var l=n.jQ;if(c){var p=c.join("html");l.html(p),n.jQize(l.children()),n.finalizeInsert(s.options)}else l.empty();delete s.selection,s.insAtRightEnd(n)},e.renderLatexText=function(t){var n=this.root,s=this.cursor;n.jQ.children().slice(1).remove(),n.eachChild("postOrder","dispose"),n.ends[u]=n.ends[1]=0,delete s.selection,s.show().insAtRightEnd(n);var a=x.regex,o=x.string,c=x.eof,l=x.all,p=o("$").then(j).skip(o("$").or(c)).map(function(b){var v=ze(s);v.createBlocks();var y=v.ends[u];return b.children().adopt(y,0,0),v}),m=o("\\$").result("$").or(a(/^[^$]/)).map(f),q=p.or(m).many().skip(c).or(l.result(!1)).parse(t);if(q){for(var w=0;w<q.length;w+=1)q[w].adopt(n,n.ends[1],0);n.jQize().appendTo(n.jQ),n.finalizeInsert(s.options)}}}),R.open(function(e){U.p.ignoreNextMousedown=L,e.delegateMouseEvents=function(){var i=this.root.jQ;this.container.bind("mousedown.mathquill",function(t){var n,s=O(t.target).closest(".mq-root-block"),a=I.byId[s.attr(z)||i.attr(z)].controller,o=a.cursor,c=o.blink,l=a.textareaSpan,p=a.textarea;t.preventDefault(),t.target.unselectable=!0,o.options.ignoreNextMousedown(t)||(o.options.ignoreNextMousedown=L,a.blurred&&(a.editable||s.prepend(l),p.focus()),o.blink=L,a.seek(O(t.target),t.pageX,t.pageY).cursor.startSelection(),s.mousemove(m),O(t.target.ownerDocument).mousemove(q).mouseup(function w(b){o.blink=c,o.selection||(a.editable?o.show():l.detach()),s.unbind("mousemove",m),O(b.target.ownerDocument).unbind("mousemove",q).unbind("mouseup",w)}));function m(w){n=O(w.target)}function q(w){o.anticursor||o.startSelection(),a.seek(n,w.pageX,w.pageY).cursor.select(),n=X}})}}),R.open(function(e){e.seek=function(i,t,n){var s=this.notify("select").cursor;if(i){var a=i.attr(z)||i.attr(Te);if(!a){var o=i.parent();a=o.attr(z)||o.attr(Te)}}var c=a?I.byId[a]:this.root;return s.clearSelection().show(),c.seek(t,s),this.scrollHoriz(),this}}),R.open(function(e){e.scrollHoriz=function(){var i=this.cursor,t=i.selection,n=this.root.jQ[0].getBoundingClientRect();if(t){var s=t.jQ[0].getBoundingClientRect(),a=s.left-(n.left+20),o=s.right-(n.right-20);if(t.ends[u]===i[1])if(a<0)l=a;else{if(!(o>0))return;s.left-o<n.left+20?l=a:l=o}else if(o>0)l=o;else{if(!(a<0))return;s.right-a>n.right-20?l=o:l=a}}else{var c=i.jQ[0].getBoundingClientRect().left;if(c>n.right-20)var l=c-(n.right-20);else{if(!(c<n.left+20))return;var l=c-(n.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+l},100)}}),R.open(function(e){U.p.substituteTextarea=function(){return O("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var i=this.textareaSpan=O('<span class="mq-textarea"></span>'),t=this.options.substituteTextarea();if(!t.nodeType)throw"substituteTextarea() must return a DOM element, got "+t;t=this.textarea=O(t).appendTo(i);var n=this;n.cursor.selectionChanged=function(){n.selectionChanged()}},e.selectionChanged=function(){var i=this;Me(i.container[0]),i.textareaSelectionTimeout===X&&(i.textareaSelectionTimeout=setTimeout(function(){i.setTextareaSelection()})),i.handle("select")},e.setTextareaSelection=function(){this.textareaSelectionTimeout=X;var i="";this.cursor.selection&&(i=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(i="$"+i+"$")),this.selectFn(i)},e.staticMathTextareaEvents=function(){var i=this,t=(i.root,i.cursor),n=i.textarea,s=i.textareaSpan;function a(){s.detach(),i.blurred=!0}this.container.prepend(P('<span class="mq-selectable">').text("$"+i.exportLatex()+"$")),i.blurred=!0,n.bind("cut paste",!1).bind("copy",function(){i.setTextareaSelection()}).focus(function(){i.blurred=!1}).blur(function(){t.selection&&t.selection.clear(),setTimeout(a)}),i.selectFn=function(o){n.val(o),o&&n.select()}},U.p.substituteKeyboardEvents=Ee,e.editablesTextareaEvents=function(){var i=this.textarea,t=this.textareaSpan,n=this.options.substituteKeyboardEvents(i,this);this.selectFn=function(s){n.select(s)},this.container.prepend(t),this.focusBlurEvents()},e.typedText=function(i){if(i===`
`)return this.handle("enter");var t=this.notify().cursor;t.parent.write(t,i),!t[1]&&t.parent.jQ.hasClass("overfrown")&&t.parent.jQ.children("[mathquill-command-id]").length>=3&&this.moveRight(),this.scrollHoriz()},e.cut=function(){var i=this,t=i.cursor;t.selection&&setTimeout(function(){i.notify("edit"),t.parent.bubble("reflow")})},e.copy=function(){this.setTextareaSelection()},e.paste=function(i){this.options.statelessClipboard&&(i=i.slice(0,1)==="$"&&i.slice(-1)==="$"?i.slice(1,-1):"\\text{"+i+"}");var t=this.notify("edit").cursor;O(t.parent.jQ[0])[0].className.indexOf("mq-text-mode")==-1&&this.writeLatex(i).cursor.show()}});var Le=d(I,function(e,i){e.finalizeInsert=function(t,n){var s=this;s.postOrder("finalizeTree",t),s.postOrder("contactWeld",n),s.postOrder("blur"),s.postOrder("reflow"),s[1].siblingCreated&&s[1].siblingCreated(t,u),s[u].siblingCreated&&s[u].siblingCreated(t,1),s.bubble("reflow")}}),g=d(Le,function(e,i){e.init=function(t,n,s){var a=this;i.init.call(a),a.ctrlSeq||(a.ctrlSeq=t),n&&(a.htmlTemplate=n),s&&(a.textTemplate=s)},e.replaces=function(t){t.disown(),this.replacedFragment=t},e.isEmpty=function(){return this.foldChildren(!0,function(t,n){return t&&n.isEmpty()})},e.parser=function(){var t=j.block,n=this;return t.times(n.numBlocks()).map(function(s){n.blocks=s;for(var a=0;a<s.length;a+=1)s[a].adopt(n,n.ends[1],0);return n})},e.createLeftOf=function(t){var n=this,s=n.replacedFragment;n.createBlocks(),i.createLeftOf.call(n,t),s&&(s.adopt(n.ends[u],0,0),s.jQ.appendTo(n.ends[u].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},e.createBlocks=function(){for(var t=this,n=t.numBlocks(),s=t.blocks=Array(n),a=0;a<n;a+=1)(s[a]=Q()).adopt(t,t.ends[1],0)},e.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[u],function(n,s){return n.isEmpty()?n:s}))},e.moveTowards=function(t,n,s){var a=s&&this[s+"Into"];n.insAtDirEnd(-t,a||this.ends[-t])},e.deleteTowards=function(t,n){this.isEmpty()?n[t]=this.remove()[t]:this.moveTowards(t,n,null)},e.selectTowards=function(t,n){n[-t]=this,n[t]=this[t]},e.selectChildren=function(){return Oe(this,this)},e.unselectInto=function(t,n){n.insAtDirEnd(-t,n.anticursor.ancestors[this.id])},e.seek=function(t,n){function s(l){var p={};return p[u]=l.jQ.offset().left,p[1]=p[u]+l.jQ.outerWidth(),p}var a=this,o=s(a);if(t<o[u])return n.insLeftOf(a);if(t>o[1])return n.insRightOf(a);var c=o[u];a.eachChild(function(l){var p=s(l);return t<p[u]?(t-c<p[u]-t?l[u]?n.insAtRightEnd(l[u]):n.insLeftOf(a):n.insAtLeftEnd(l),!1):t>p[1]?void(l[1]?c=p[1]:o[1]-t<t-p[1]?n.insRightOf(a):n.insAtRightEnd(l)):(l.seek(t,n),!1)})},e.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},e.html=function(){var t=this,n=t.blocks,s=" mathquill-command-id="+t.id,a=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);a.join(""),this.htmlTemplate;for(var o=0,c=a[0];c;c=a[o+=1])if(c.slice(-2)==="/>")a[o]=c.slice(0,-2)+s+"/>";else if(c.charAt(0)==="<"){c.charAt(1),a[o]=c.slice(0,-1)+s+">";var l=1;do(c=a[o+=1]).slice(0,2)==="</"?l-=1:c.charAt(0)==="<"&&c.slice(-2)!=="/>"&&(l+=1);while(l>0)}return a.join("").replace(/>&(\d+)/g,function(p,m){return" mathquill-block-id="+n[m].id+">"+n[m].join("html")})},e.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,n){return t+"{"+(n.latex()||" ")+"}"})},e.textTemplate=[""],e.text=function(){var t=this,n=0;return t.foldChildren(t.textTemplate[n],function(s,a){n+=1;var o=a.text();return s&&t.textTemplate[n]==="("&&o[0]==="("&&o.slice(-1)===")"?s+o.slice(1,-1)+t.textTemplate[n]:s+a.text()+(t.textTemplate[n]||"")})}}),F=d(g,function(e,i){e.init=function(t,n,s){s||(s=t&&t.length>1?t.slice(1):t),i.init.call(this,t,n,[s])},e.parser=function(){return x.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=L,e.moveTowards=function(t,n){n.jQ.insDirOf(t,this.jQ),n[-t]=this,n[t]=this[t]},e.deleteTowards=function(t,n){n[t]=this.remove()[t]},e.seek=function(t,n){t-this.jQ.offset().left<this.jQ.outerWidth()/2?n.insLeftOf(this):n.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=L,e.isEmpty=function(){return!0}}),f=d(F,function(e,i){e.init=function(t,n){i.init.call(this,t,"<span>"+(n||t)+"</span>")}}),T=d(F,function(e,i){e.init=function(t,n,s){i.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",s)}}),Q=d(Le,function(e,i){e.join=function(t){return this.foldChildren("",function(n,s){return n.indexOf("\\lbrace ")>=0&&(n=n.replace(/\\lbrace /g,"\\begin{cases}")),n+s[t]()})},e.html=function(){return this.join("html")},e.latex=function(){return this.join("latex")},e.text=function(){return this.ends[u]===this.ends[1]&&this.ends[u]!==0?this.ends[u].text():this.join("text")},e.keystroke=function(t,n,s){return!s.options.spaceBehavesLikeTab||t!=="Spacebar"&&t!=="Shift-Spacebar"?i.keystroke.apply(this,arguments):(n.preventDefault(),void s.escapeDir(t==="Shift-Spacebar"?u:1,t,n))},e.moveOutOf=function(t,n,s){!(s&&this.parent[s+"Into"])&&this[t]?n.insAtDirEnd(-t,this[t]):n.insDirOf(t,this.parent)},e.selectOutOf=function(t,n){n.insDirOf(t,this.parent)},e.deleteOutOf=function(t,n){n.unwrapGramp()},e.seek=function(t,n){var s=this.ends[1];if(!s||s.jQ.offset().left+s.jQ.outerWidth()<t)return n.insAtRightEnd(this);if(t<this.ends[u].jQ.offset().left)return n.insAtLeftEnd(this);for(;t<s.jQ.offset().left;)s=s[u];return s.seek(t,n)},e.chToCmd=function(t,n){var s;return t.match(/^[a-zA-Z]$/)?N(t):/^\d$/.test(t)?Ye(t):n&&n.typingSlashWritesDivisionSymbol&&t==="/"?r["÷"](t):n&&n.typingAsteriskWritesTimesSymbol&&t==="*"?r["×"](t):(s=Y[t]||r[t])?s(t):f(t)},e.write=function(t,n){var s=this.chToCmd(n,t.options);t.selection&&s.replaces(t.replaceSelection()),s.createLeftOf(t.show())},e.focus=function(){return window.$currentJQ=this.jQ,this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this.isEmpty()&&this.jQ.addClass("mq-outLine"),this},e.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.jQ.removeClass("mq-outLine"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});Z.StaticMath=function(e){return d(e.AbstractMathQuill,function(i,t){this.RootBlock=Q,i.__mathquillify=function(n,s){return this.config(n),t.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},i.init=function(){t.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],e.MathField)},i.latex=function(){var n=t.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],e.MathField),n}})};var Ae=d(Q,_e);Z.MathField=function(e){return d(e.EditableField,function(i,t){this.RootBlock=Ae,i.__mathquillify=function(n,s){return this.config(n),s>1&&(this.__controller.root.reflow=L),t.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})};var ee=d(I,function(e,i){function t(n){n.jQ[0].normalize();var s=n.jQ[0].firstChild;if(s){s.nodeType;var a=V(s.data);return a.jQadd(s),n.children().disown(),a.adopt(n,0,0)}}e.ctrlSeq="\\text",e.replaces=function(n){n instanceof D?this.replacedText=n.remove().jQ.text():typeof n=="string"&&(this.replacedText=n)},e.jQadd=function(n){i.jQadd.call(this,n),this.ends[u]&&this.ends[u].jQadd(this.jQ[0].firstChild)},e.createLeftOf=function(n){var s=this;if(i.createLeftOf.call(this,n),s[1].siblingCreated&&s[1].siblingCreated(n.options,u),s[u].siblingCreated&&s[u].siblingCreated(n.options,1),s.bubble("reflow"),n.insAtRightEnd(s),s.replacedText)for(var a=0;a<s.replacedText.length;a+=1)s.write(n,s.replacedText.charAt(a))},e.parser=function(){var n=this,s=x.string,a=x.regex;return x.optWhitespace.then(s("{")).then(a(/^[^}]*/)).skip(s("}")).map(function(o){return o.length===0?D():(V(o).adopt(n,0,0),n)})},e.textContents=function(){return this.foldChildren("",function(n,s){return n+(typeof s.text=="function"?s.text():s.text)})},e.text=function(){return this.textContents()},e.latex=function(){var n=this.textContents();return n.length===0,""},e.html=function(){return'<span class="mq-text-mode"  mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},e.moveTowards=function(n,s){s.insAtDirEnd(-n,this)},e.moveOutOf=function(n,s){s.insDirOf(n,this)},e.unselectInto=e.moveTowards,e.selectTowards=g.prototype.selectTowards,e.deleteTowards=g.prototype.deleteTowards,e.selectOutOf=function(n,s){s.insDirOf(n,this)},e.deleteOutOf=function(n,s){this.isEmpty()&&s.insRightOf(this)},e.write=function(n,s){if(n.show().deleteSelection(),s!=="$")n[u]?n[u].appendText(s):V(s).createLeftOf(n);else if(this.isEmpty())n.insRightOf(this),f("\\$","$").createLeftOf(n);else if(n[1])if(n[u]){var a=ee(),o=this.ends[u];o.disown().jQ.detach(),o.adopt(a,0,0),n.insLeftOf(this),i.createLeftOf.call(a,n)}else n.insLeftOf(this);else n.insRightOf(this)},e.seek=function(n,s){s.hide();var a=t(this),o=this.jQ.width()/this.text.length,c=Math.round((n-this.jQ.offset().left)/o);c<=0?s.insAtLeftEnd(this):c>=a.text.length?s.insAtRightEnd(this):s.insLeftOf(a.splitRight(c));for(var l=n-s.show().offset().left,p=l&&l<0?u:1,m=p;s[p]&&l*m>0;)s[p].moveTowards(p,s),m=l,l=n-s.offset().left;if(p*l<-p*m&&s[-p].moveTowards(-p,s),s.anticursor){if(s.anticursor.parent===this){var q=s[u]&&s[u].text.length;if(this.anticursorPosition===q)s.anticursor=M.copy(s);else{if(this.anticursorPosition<q){var w=s[u].splitRight(this.anticursorPosition);s[u]=w}else w=s[1].splitRight(this.anticursorPosition-q);s.anticursor=M(this,w[u],w)}}}else this.anticursorPosition=s[u]&&s[u].text.length},e.blur=function(n){Q.prototype.blur.call(this),n&&(this.textContents()===""?(this.remove(),n[u]===this?n[u]=this[u]:n[1]===this&&(n[1]=this[1])):t(this))},e.focus=Q.prototype.focus}),V=d(I,function(e,i){function t(n,s){return s.charAt(n===u?0:-1+s.length)}e.init=function(n){i.init.call(this),this.text=n},e.jQadd=function(n){this.dom=n,this.jQ=O(n)},e.jQize=function(){return this.jQadd(document.createTextNode(this.text))},e.appendText=function(n){this.text+=n,this.dom.appendData(n)},e.prependText=function(n){this.text=n+this.text,this.dom.insertData(0,n)},e.insTextAtDirEnd=function(n,s){s===1?this.appendText(n):this.prependText(n)},e.splitRight=function(n){var s=V(this.text.slice(n)).adopt(this.parent,this,this[1]);return s.jQadd(this.dom.splitText(n)),this.text=this.text.slice(0,n),s},e.moveTowards=function(n,s){var a=t(-n,this.text),o=this[-n];return o?o.insTextAtDirEnd(a,n):V(a).createDir(-n,s),this.deleteTowards(n,s)},e.latex=function(){return this.text},e.deleteTowards=function(n,s){this.text.length>1?n===1?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),s[n]=this[n])},e.selectTowards=function(n,s){var a=s.anticursor,o=t(-n,this.text);if(a[n]===this){var c=V(o).createDir(n,s);a[n]=c,s.insDirOf(n,c)}else{var l=this[-n];l?l.insTextAtDirEnd(o,n):(c=V(o).createDir(-n,s)).jQ.insDirOf(-n,s.selection.jQ),this.text.length===1&&a[-n]===this&&(a[-n]=this[-n])}return this.deleteTowards(n,s)}});function K(e,i,t){return d(ee,{ctrlSeq:e,htmlTemplate:"<"+i+" "+t+">&0</"+i+">"})}r.text=r.textnormal=r.textup=r.textmd=ee,r.em=r.italic=r.italics=r.emph=r.textsl=K("\\textit","i",'class="mq-text-mode"'),r.strong=r.bold=r.textbf=K("\\textbf","b",'class="mq-text-mode"'),r.sf=r.textsf=K("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),r.tt=r.texttt=K("\\texttt","span",'class="mq-monospace mq-text-mode"'),r.textsc=K("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),r.uppercase=K("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),r.lowercase=K("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var ze=d(g,function(e,i){e.init=function(t){i.init.call(this,"$"),this.cursor=t},e.htmlTemplate='<span class="mq-math-mode">&0</span>',e.createBlocks=function(){i.createBlocks.call(this),this.ends[u].cursor=this.cursor,this.ends[u].write=function(t,n){n!=="$"?Q.prototype.write.call(this,t,n):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),f("\\$","$").createLeftOf(t.show())):t[1]?t[u]?Q.prototype.write.call(this,t,n):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},e.latex=function(){return"$"+this.ends[u].latex()+"$"}}),Ke=d(Ae,function(e,i){e.keystroke=function(t){if(t!=="Spacebar"&&t!=="Shift-Spacebar")return i.keystroke.apply(this,arguments)},e.write=function(t,n){var s;t.show().deleteSelection(),n==="$"?ze(t).createLeftOf(t):(n==="<"?s="&lt;":n===">"&&(s="&gt;"),f(n,s).createLeftOf(t))}});Z.TextField=function(e){return d(e.EditableField,function(i,t){this.RootBlock=Ke,i.__mathquillify=function(){return t.__mathquillify.call(this,"mq-editable-field mq-text-mode")},i.latex=function(n){return arguments.length>0?(this.__controller.renderLatexText(n),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},Y["\\"]=d(g,function(e,i){e.ctrlSeq="\\",e.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},e.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',e.textTemplate=["\\"],e.createBlocks=function(){i.createBlocks.call(this),this.ends[u].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[u].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[u].write=function(t,n){t.show().deleteSelection(),n.match(/[a-z]/i)?f(n).createLeftOf(t):(this.parent.renderCommand(t),n==="\\"&&this.isEmpty()||t.parent.write(t,n))},this.ends[u].keystroke=function(t,n,s){return t==="Tab"||t==="Enter"||t==="Spacebar"?(this.parent.renderCommand(s.cursor,t==="Enter"),void(t==="Enter"&&window.$selectItem&&n.preventDefault())):i.keystroke.apply(this,arguments)}},e.createLeftOf=function(t){if(i.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(s){return O(s.target=n).trigger(s),!1}).insertBefore(this.jQ).add(this.jQ)}},e.latex=function(){return"\\"+this.ends[u].latex()+" "},e.renderCommand=function(t,n){this.jQ=this.jQ.last(),this.remove(),this[1]?t.insLeftOf(this[1]):t.insAtRightEnd(this.parent);var s=this.ends[u].latex();s||(s=" "),n&&window.$selectItem&&(s=window.$selectItem);var a=r[s];a?(a=a(s),this._replacedFragment&&a.replaces(this._replacedFragment),a.createLeftOf(t)):((a=ee()).replaces(s),a.createLeftOf(t),t.insRightOf(a),this._replacedFragment&&this._replacedFragment.remove())}}),r.notin=r.cong=r.equiv=r.oplus=r.otimes=d(T,function(e,i){e.init=function(t){i.init.call(this,"\\"+t+" ","&"+t+";")}}),r["≠"]=r.ne=r.neq=h(T,"\\ne ","&ne;"),r["∗"]=r.ast=r.star=r.loast=r.lowast=h(T,"\\ast ","&lowast;"),r.therefor=r.therefore=h(T,"\\therefore ","&there4;"),r.cuz=r.because=h(T,"\\because ","&#8757;"),r.prop=r.propto=h(T,"\\propto ","&prop;"),r["≈"]=r.asymp=r.approx=h(T,"\\approx ","&asymp;"),r.isin=r.in=h(T,"\\in ","&isin;"),r.ni=r.contains=h(T,"\\ni ","&ni;"),r.notni=r.niton=r.notcontains=r.doesnotcontain=h(T,"\\not\\ni ","&#8716;"),r.sub=r.subset=h(T,"\\subset ","&sub;"),r.sup=r.supset=r.superset=h(T,"\\supset ","&sup;"),r.nsub=r.notsub=r.nsubset=r.notsubset=h(T,"\\nsubset ","&#8836;"),r.nsup=r.notsup=r.nsupset=r.notsupset=r.nsuperset=r.notsuperset=h(T,"\\nsupset ","&#8837;"),r.sube=r.subeq=r.subsete=r.subseteq=h(T,"\\subseteq ","&sube;"),r.supe=r.supeq=r.supsete=r.supseteq=r.supersete=r.superseteq=h(T,"\\supseteq ","&supe;"),r.nsube=r.nsubeq=r.notsube=r.notsubeq=r.nsubsete=r.nsubseteq=r.notsubsete=r.notsubseteq=h(T,"\\not\\subseteq ","&#8840;"),r.nsupe=r.nsupeq=r.notsupe=r.notsupeq=r.nsupsete=r.nsupseteq=r.notsupsete=r.notsupseteq=r.nsupersete=r.nsuperseteq=r.notsupersete=r.notsuperseteq=h(T,"\\not\\supseteq ","&#8841;"),r.ℕ=r.naturals=r.Naturals=h(f,"ℕ",'<span style="font-family:Symbola;">&#8469;</span>'),r.ℙ=r.primes=r.Primes=r.projective=r.Projective=r.probability=r.Probability=h(f,"ℙ",'<span style="font-family:Symbola;">&#8473;</span>'),r.ℤ=r.integers=r.Integers=h(f,"ℤ",'<span style="font-famil:Symbola;">&#8484;</span>'),r.ℚ=r.rationals=r.Rationals=h(f,"ℚ",'<span style="font-family:Symbola;">&#8474;</span>'),r.ℝ=r.reals=r.Reals=h(f,"ℝ",'<span style="font-family:Symbola;">&#8477;</span>'),r.ℂ=r.complex=r.Complex=r.complexes=r.Complexes=r.complexplane=r.Complexplane=r.ComplexPlane=h(f,"ℂ",'<span style="font-family:Symbola;">&#8450;</span>'),r.ℍ=r.Hamiltonian=r.quaternions=r.Quaternions=h(f,"ℍ",'<span style="font-family:Symbola;">&#8461;</span>'),r.quad=r.emsp=h(f,"\\quad ","    "),r.qquad=h(f,"\\qquad ","        "),r.diamond=h(f,"\\diamond ","&#9671;"),r.bigtriangleup=h(f,"\\bigtriangleup ","&#9651;"),r.ominus=h(f,"\\ominus ","&#8854;"),r.uplus=h(f,"\\uplus ","&#8846;"),r.bigtriangledown=h(f,"\\bigtriangledown ","&#9661;"),r.sqcap=h(f,"\\sqcap ","&#8851;"),r.triangleleft=h(f,"\\triangleleft ","&#8882;"),r.sqcup=h(f,"\\sqcup ","&#8852;"),r.triangleright=h(f,"\\triangleright ","&#8883;"),r.odot=r.circledot=h(f,"\\odot ","&#8857;"),r.bigcirc=h(f,"\\bigcirc ","&#9711;"),r.dagger=h(f,"\\dagger ","&#0134;"),r.ddagger=h(f,"\\ddagger ","&#135;"),r.wr=h(f,"\\wr ","&#8768;"),r.amalg=h(f,"\\amalg ","&#8720;"),r.models=h(f,"\\models ","&#8872;"),r.prec=h(f,"\\prec ","&#8826;"),r.succ=h(f,"\\succ ","&#8827;"),r.preceq=h(f,"\\preceq ","&#8828;"),r.succeq=h(f,"\\succeq ","&#8829;"),r.simeq=h(f,"\\simeq ","&#8771;"),r.mid=h(f,"\\mid ","&#8739;"),r.ll=h(f,"\\ll ","&#8810;"),r.gg=h(f,"\\gg ","&#8811;"),r.parallel=h(f,"\\parallel ","&#8741;"),r.nparallel=h(f,"\\nparallel ","&#8742;"),r.bowtie=h(f,"\\bowtie ","&#8904;"),r.sqsubset=h(f,"\\sqsubset ","&#8847;"),r.sqsupset=h(f,"\\sqsupset ","&#8848;"),r.smile=h(f,"\\smile ","&#8995;"),r.sqsubseteq=h(f,"\\sqsubseteq ","&#8849;"),r.sqsupseteq=h(f,"\\sqsupseteq ","&#8850;"),r.doteq=h(f,"\\doteq ","&#8784;"),r.frown=h(f,"\\frown ","&#8994;"),r.vdash=h(f,"\\vdash ","&#8870;"),r.dashv=h(f,"\\dashv ","&#8867;"),r.nless=h(f,"\\nless ","&#8814;"),r.ngtr=h(f,"\\ngtr ","&#8815;"),r.triangleq=h(f,"\\triangleq ","&#8796;"),r.wedgeeq=h(f,"\\wedgeeq ","&#8793;"),r.backsimeqs=h(f,"\\backsimeqs ","&#8780;"),r.longleftarrow=h(f,"\\longleftarrow ","&#10229;"),r.longrightarrow=h(f,"\\longrightarrow ","&#10230;"),r.Longleftarrow=h(f,"\\Longleftarrow ","&#10232;"),r.Longrightarrow=h(f,"\\Longrightarrow ","&#10233;"),r.longleftrightarrow=h(f,"\\longleftrightarrow ","&#10231;"),r.updownarrow=h(f,"\\updownarrow ","&#8597;"),r.Longleftrightarrow=h(f,"\\Longleftrightarrow ","&#8660;"),r.Updownarrow=h(f,"\\Updownarrow ","&#8661;"),r.mapsto=h(f,"\\mapsto ","&#8614;"),r.nearrow=h(f,"\\nearrow ","&#8599;"),r.hookleftarrow=h(f,"\\hookleftarrow ","&#8617;"),r.hookrightarrow=h(f,"\\hookrightarrow ","&#8618;"),r.searrow=h(f,"\\searrow ","&#8600;"),r.leftharpoonup=h(f,"\\leftharpoonup ","&#8636;"),r.rightharpoonup=h(f,"\\rightharpoonup ","&#8640;"),r.swarrow=h(f,"\\swarrow ","&#8601;"),r.leftharpoondown=h(f,"\\leftharpoondown ","&#8637;"),r.rightharpoondown=h(f,"\\rightharpoondown ","&#8641;"),r.nwarrow=h(f,"\\nwarrow ","&#8598;"),r.neswarrow=h(f,"\\neswarrow ","&#10530;"),r.swnearrow=h(f,"\\swnearrow ","&#10529;"),r.smallleftright=h(f,"\\smallleftright ","&#10564;"),r.leftrightsmall=h(f,"\\leftrightsmall ","&#10562;"),r.rightleftarrows=h(f,"\\rightleftarrows ","&#8644;"),r.leftrightarrows=h(f,"\\leftrightarrows ","&#8646;"),r.ldots=h(f,"\\ldots ","&#8230;"),r.cdots=h(f,"\\cdots ","&#8943;"),r.centerdot=h(f,"\\centerdot ","<span>.</span>"),r.vdots=h(f,"\\vdots ","&#8942;"),r.iddots=h(f,"\\iddots ","&#8944;"),r.ddots=h(f,"\\ddots ","&#8945;"),r.surd=h(f,"\\surd ","&#8730;"),r.triangle=h(f,"\\triangle ","&#9651;"),r.ell=h(f,"\\ell ","&#8467;"),r.top=h(f,"\\top ","&#8868;"),r.flat=h(f,"\\flat ","&#9837;"),r.natural=h(f,"\\natural ","&#9838;"),r.sharp=h(f,"\\sharp ","&#9839;"),r.wp=h(f,"\\wp ","&#8472;"),r.bot=h(f,"\\bot ","&#8869;"),r.clubsuit=h(f,"\\clubsuit ","&#9827;"),r.diamondsuit=h(f,"\\diamondsuit ","&#9826;"),r.heartsuit=h(f,"\\heartsuit ","&#9825;"),r.spadesuit=h(f,"\\spadesuit ","&#9824;"),r.parallelogram=h(f,"\\parallelogram ","&#9649;"),r.oint=h(f,"\\oint ","&#8750;"),r.bigcap=h(f,"\\bigcap ","&bigcap;"),r.bigcup=h(f,"\\bigcup ","&#8899;"),r.bigsqcup=h(f,"\\bigsqcup ","&#8852;"),r.bigvee=h(f,"\\bigvee ","&#8744;"),r.bigwedge=h(f,"\\bigwedge ","&#8743;"),r.bigodot=h(f,"\\bigodot ","&#8857;"),r.bigotimes=h(f,"\\bigotimes ","&#8855;"),r.bigoplus=h(f,"\\bigoplus ","&#8853;"),r.biguplus=h(f,"\\biguplus ","&#8846;"),r.lfloor=h(f,"\\lfloor ","&#8970;"),r.rfloor=h(f,"\\rfloor ","&#8971;"),r.lceil=h(f,"\\lceil ","&#8968;"),r.rceil=h(f,"\\rceil ","&#8969;"),r.opencurlybrace=r.lbrace=h(f,"\\lbrace ","{"),r.closecurlybrace=r.rbrace=h(f,"\\rbrace ","}"),r.lbrack=h(f,"["),r.rbrack=h(f,"]"),r.slash=h(f,"/"),r.vert=h(f,"|"),r.perp=r.perpendicular=h(f,"\\perp ","&perp;"),r.nabla=r.del=h(f,"\\nabla ","&nabla;"),r.hbar=h(f,"\\hbar ","&#8463;"),r.AA=r.Angstrom=r.angstrom=h(f,"\\text\\AA ","&#8491;"),r.ring=r.circ=r.circle=h(f,"\\circ ","&#8728;"),r.bull=r.bullet=h(f,"\\bullet ","&bull;"),r.setminus=r.smallsetminus=h(f,"\\setminus ","&#8726;"),r["¬"]=r.neg=h(f,"\\neg ","&not;"),r["…"]=r.dots=r.ellip=r.hellip=r.ellipsis=r.hellipsis=h(f,"\\dots ","&hellip;"),r.converges=r.darr=r.dnarr=r.dnarrow=r.downarrow=h(f,"\\downarrow ","&darr;"),r.dArr=r.dnArr=r.dnArrow=r.Downarrow=h(f,"\\Downarrow ","&dArr;"),r.diverges=r.uarr=r.uparrow=h(f,"\\uparrow ","&uarr;"),r.uArr=r.Uparrow=h(f,"\\Uparrow ","&uArr;"),r.to=h(T,"\\to ","&rarr;"),r.rarr=r.rightarrow=h(f,"\\rightarrow ","&rarr;"),r.implies=h(T,"\\Rightarrow ","&rArr;"),r.rArr=r.Rightarrow=h(f,"\\Rightarrow ","&rArr;"),r.gets=h(T,"\\gets ","&larr;"),r.larr=r.leftarrow=h(f,"\\leftarrow ","&larr;"),r.impliedby=h(T,"\\Leftarrow ","&lArr;"),r.lArr=r.Leftarrow=h(f,"\\Leftarrow ","&lArr;"),r.harr=r.lrarr=r.leftrightarrow=h(f,"\\leftrightarrow ","&harr;"),r.iff=h(T,"\\Leftrightarrow ","&hArr;"),r.hArr=r.lrArr=r.Leftrightarrow=h(f,"\\Leftrightarrow ","&hArr;"),r.Re=r.Real=r.real=h(f,"\\Re ","&real;"),r.Im=r.imag=r.image=r.imagin=r.imaginary=r.Imaginary=h(f,"\\Im ","&image;"),r.part=r.partial=h(f,"\\partial ","&part;"),r.infty=r.infin=r.infinity=h(f,"\\infty ","&infin;"),r.alef=r.alefsym=r.aleph=r.alephsym=h(f,"\\aleph ","&alefsym;"),r.xist=r.xists=r.exist=r.exists=h(f,"\\exists ","&exist;"),r.nexists=r.nexist=h(f,"\\nexists ","&#8708;"),r.and=r.land=r.wedge=h(T,"\\wedge ","&and;"),r.or=r.lor=r.vee=h(T,"\\vee ","&or;"),r.o=r.O=r.empty=r.emptyset=r.oslash=r.Oslash=r.nothing=r.varnothing=h(T,"\\varnothing ","&empty;"),r.cup=r.union=h(T,"\\cup ","&cup;"),r.cap=r.intersect=r.intersection=h(T,"\\cap ","&cap;"),r.deg=r.degree=h(f,"\\degree ","&deg;"),r.ang=r.angle=h(f,"\\angle ","&ang;"),r.measuredangle=h(f,"\\measuredangle ","&#8737;"),r.square=h(f,"\\square ","&#x25A1;"),r.bigstar=h(f,"\\bigstar ","&#x2605;"),r.complement=h(f,"\\complement ","&#x2201;"),r.subsetneqq=h(f,"\\subsetneqq ","&#x2ACB;"),r.leqslant=h(f,"\\leqslant ","&#x2A7D;"),r.leqslant=h(f,"\\leqslant ","&#x2A7D;"),r.geqslant=h(f,"\\geqslant ","&#x2A7E;"),r.triangleleft=h(f,"\\triangleleft ",'<span class="mq-triangle">◁</span>'),r.triangleright=h(f,"\\triangleright ",'<span class="mq-triangle">▷</span>'),r.rightleftharpoons=h(f,"\\rightleftharpoons ","&#8651;"),r.Downarrow=h(f,"\\Downarrow ","&#x21D3;"),r.Uparrow=h(f,"\\Uparrow ","&#x21D1;"),r.overrightarrow=h(f,"\\overrightarrow ","&#x2192;"),r.overleftarrow=h(f,"\\overleftarrow ","&#x2190;"),r.int=h(f,"\\int ","&int;"),r.iint=h(f,"\\iint ","∬"),r.iiint=h(f,"\\iiint ","&#8749;"),r.iiiint=h(f,"\\iiiint ","&#x222B;"),r.oint=h(f,"\\oint ","&#8750;"),r.prod=h(f,"\\prod ","&prod;"),r.coprod=h(f,"\\coprod ","∐"),r.thicksim=h(f,"\\thicksim ","~"),r.backsim=h(f,"\\backsim ","∽");var Ye=d(f,function(e,i){e.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[u]instanceof C&&t[u].isItalic!==!1||t[u]instanceof H&&t[u][u]instanceof C&&t[u][u].isItalic!==!1)?(r._().createLeftOf(t),i.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):i.createLeftOf.call(this,t)}});r["text{}"]=ee;var C=d(F,function(e,i){e.init=function(t,n){E.curFontFamily=="TeX",E.isSelectedItalic,i.init.call(this,t,"<var>"+(n||t)+"</var>")},e.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator&&(t[0]=="\\"?t=t.slice(1,t.length):t[t.length-1]==" "&&(t=t.slice(0,-1))),t}});U.p.autoCommands={_maxLength:0},ie.autoCommands=function(e){if(!/^[a-z]+(?: [a-z]+)*$/i.test(e))throw'"'+e+'" not a space-delimited list of only letters';for(var i=e.split(" "),t={},n=0,s=0;s<i.length;s+=1){var a=i[s];if(a.length<2)throw'autocommand "'+a+'" not minimum length of 2';if(r[a]===Ie)throw'"'+a+'" is a built-in operator name';t[a]=1,n=ke(n,a.length)}return t._maxLength=n,t};var N=d(C,function(e,i){function t(n){return!n||n instanceof T||n instanceof we}e.init=function(n){return i.init.call(this,this.letter=n)},e.createLeftOf=function(n){i.createLeftOf.apply(this,arguments);var s=n.options.autoCommands,a=s._maxLength;if(a>0){for(var o="",c=this,l=0;c instanceof N&&c.ctrlSeq===c.letter&&l<a;)o=c.letter+o,c=c[u],l+=1;for(;o.length;){if(s.hasOwnProperty(o)){for(l=1,c=this;l<o.length;l+=1,c=c[u]);return D(c,this).remove(),n[u]=c[u],r[o](o).createLeftOf(n)}o=o.slice(1)}}},e.italicize=function(n){return this.isItalic=n,this.isPartOfOperator=!n,this.jQ.toggleClass("mq-operator-name",!n),this},e.finalizeTree=e.siblingDeleted=e.siblingCreated=function(n,s){s!==u&&this[1]instanceof N||this.autoUnItalicize(n)},e.autoUnItalicize=function(n){var s=n.autoOperatorNames;if(s._maxLength!==0){for(var a=this.letter,o=this[u];o instanceof N;o=o[u])a=o.letter+a;for(var c=this[1];c instanceof N;c=c[1])a+=c.letter;D(o[1]||this.parent.ends[u],c[u]||this.parent.ends[1]).each(function(S){S.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),S.ctrlSeq=S.letter});e:for(var l=0,p=o[1]||this.parent.ends[u];l<a.length;l+=1,p=p[1])for(var m=J(s._maxLength,a.length-l);m>0;m-=1){var q=a.slice(l,l+m);if(s.hasOwnProperty(q)){for(var w=0,b=p;w<m;w+=1,b=b[1]){b.italicize(!1);var v=b}var y=ve.hasOwnProperty(q);if(p.ctrlSeq=(y?"\\":"\\operatorname{")+p.ctrlSeq,v.ctrlSeq+=y?" ":"}",Ge.hasOwnProperty(q)&&v[u][u][u].jQ.addClass("mq-last"),t(p[u])||p.jQ.addClass("mq-first"),!t(v[1]))if(v[1]instanceof H){var k=v[1];(k.siblingCreated=k.siblingDeleted=function(){k.jQ.toggleClass("mq-after-operator-name",!(k[1]instanceof le))})()}else v.jQ.toggleClass("mq-last",!(v[1]instanceof le));l+=m-1,p=v;continue e}}}}}),ve={},W=U.p.autoOperatorNames={_maxLength:9},Ge={limsup:1,liminf:1,projlim:1,injlim:1};(function(){for(var e="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),i=0;i<e.length;i+=1)ve[e[i]]=W[e[i]]=1;var t="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(i=0;i<t.length;i+=1)ve[t[i]]=1;var n="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(i=0;i<n.length;i+=1)W[n[i]]=W["arc"+n[i]]=W[n[i]+"h"]=W["ar"+n[i]+"h"]=W["arc"+n[i]+"h"]=1;var s="gcf hcf lcm proj span".split(" ");for(i=0;i<s.length;i+=1)W[s[i]]=1})(),ie.autoOperatorNames=function(e){if(!/^[a-z]+(?: [a-z]+)*$/i.test(e))throw'"'+e+'" not a space-delimited list of only letters';for(var i=e.split(" "),t={},n=0,s=0;s<i.length;s+=1){var a=i[s];if(a.length<2)throw'"'+a+'" not minimum length of 2';t[a]=1,n=ke(n,a.length)}return t._maxLength=n,t};var Ie=d(F,function(e,i){e.init=function(t){this.ctrlSeq=t},e.createLeftOf=function(t){for(var n=this.ctrlSeq,s=0;s<n.length;s+=1)N(n.charAt(s)).createLeftOf(t)},e.parser=function(){for(var t=this.ctrlSeq,n=Q(),s=0;s<t.length;s+=1)N(t.charAt(s)).adopt(n,n.ends[1],0);return x.succeed(n.children())}});for(var Re in W)W.hasOwnProperty(Re)&&(r[Re]=Ie);r.operatorname=d(g,function(e){e.createLeftOf=L,e.numBlocks=function(){return 1},e.parser=function(){return j.block.map(function(i){return i.children()})}}),r[" "]=r.space=h(f,"\\ ","&nbsp;"),r.prime=h(f,"\\prime ","&prime;"),r.Prime=r.dprime=h(f,"\\Prime ","&Prime;"),r.backprime=h(f,"\\backprime ","&#96;"),r.backslash=h(f,"\\backslash ","\\"),Y["\\"]||(Y["\\"]=r.backslash),r.$=h(f,"\\$","$"),r["#"]=h(f,"\\#","#");var te=d(F,function(e,i){e.init=function(t,n){i.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}});r["@"]=te,r["&"]=h(te,"\\&","&amp;"),r["%"]=h(te,"\\%","%"),r.alpha=r.beta=r.gamma=r.delta=r.zeta=r.eta=r.theta=r.iota=r.kappa=r.mu=r.nu=r.omicron=r.xi=r.rho=r.sigma=r.tau=r.chi=r.psi=r.omega=d(C,function(e,i){e.init=function(t){i.init.call(this,"\\"+t+" ","&"+t+";")}}),r.phi=h(C,"\\phi ","&#981;"),r.Phi=h(C,"\\Phi ","&#934;"),r.phiv=r.varphi=h(C,"\\varphi ","&#966;"),r.epsilon=h(C,"\\epsilon ","&#1013;"),r.epsiv=r.varepsilon=h(C,"\\varepsilon ","&epsilon;"),r.piv=r.varpi=h(C,"\\varpi ","&piv;"),r.sigmaf=r.sigmav=r.varsigma=h(C,"\\varsigma ","&sigmaf;"),r.thetav=r.vartheta=r.thetasym=h(C,"\\vartheta ","&thetasym;"),r.upsilon=r.upsi=h(C,"\\upsilon ","&upsilon;"),r.gammad=r.Gammad=r.digamma=h(C,"\\digamma ","&#989;"),r.kappav=r.varkappa=h(C,"\\varkappa ","&#1008;"),r.rhov=r.varrho=h(C,"\\varrho ","&#1009;"),r.pi=r.π=h(te,"\\pi ","&pi;"),r.lambda=h(te,"\\lambda ","&lambda;"),r.Upsilon=r.Upsi=r.upsih=r.Upsih=h(F,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),r.Gamma=r.Delta=r.Theta=r.Lambda=r.Xi=r.Pi=r.Sigma=r.Psi=r.Omega=r.forall=d(f,function(e,i){e.init=function(t){i.init.call(this,"\\"+t+" ","&"+t+";")}});var G=d(g,function(e){e.init=function(i){this.latex=i},e.createLeftOf=function(i){var t=j.parse(this.latex);t.children().adopt(i.parent,i[u],i[1]),i[u]=t.ends[1],t.jQize().insertBefore(i.jQ),t.finalizeInsert(i.options,i),t.ends[1][1].siblingCreated&&t.ends[1][1].siblingCreated(i.options,u),t.ends[u][u].siblingCreated&&t.ends[u][u].siblingCreated(i.options,1),i.parent.bubble("reflow")},e.parser=function(){var i=j.parse(this.latex).children();return x.succeed(i)}});r["¹"]=h(G,"^1"),r["²"]=h(G,"^2"),r["³"]=h(G,"^3"),r["¼"]=h(G,"\\frac14"),r["½"]=h(G,"\\frac12"),r["¾"]=h(G,"\\frac34");var oe=d(T,function(e){e.init=f.prototype.init,e.contactWeld=e.siblingCreated=e.siblingDeleted=function(i,t){if(t!==1)return this.jQ[0].className=function n(s){return s[u]?s[u]instanceof T||/^[,;:\(\[]$/.test(s[u].ctrlSeq)?"":"mq-binary-operator":s.parent&&s.parent.parent&&s.parent.parent.isStyleBlock()?n(s.parent.parent):""}(this),this}});r["+"]=h(oe,"+","+"),r["–"]=r["-"]=h(oe,"-","&minus;"),r["±"]=r.pm=r.plusmn=r.plusminus=h(oe,"\\pm ","&plusmn;"),r.mp=r.mnplus=r.minusplus=h(oe,"\\mp ","&#8723;"),r.sdot=r.cdot=h(T,"\\cdot ","&middot;","*"),Y["*"]=h(T,"*","*");var ge=d(T,function(e,i){e.init=function(t,n){this.data=t,this.strict=n;var s=n?"Strict":"";i.init.call(this,t["ctrlSeq"+s],t["html"+s],t["text"+s])},e.swap=function(t){this.strict=t;var n=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+n],this.jQ.html(this.data["html"+n]),this.textTemplate=[this.data["text"+n]]},e.deleteTowards=function(t,n){if(t===u&&!this.strict)return this.swap(!0),void this.bubble("reflow");i.deleteTowards.apply(this,arguments)}});r["<"]=r.lt=h(T,"\\lt ","&lt;"),r[">"]=r.gt=h(T,"\\gt ","&gt;"),r["≤"]=r.le=r.leq=h(ge,{ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},!1),r["≥"]=r.ge=r.geq=h(ge,{ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},!1);var Be=d(T,function(e,i){e.init=function(){i.init.call(this,"=","=")},e.createLeftOf=function(t){if(t[u]instanceof ge&&t[u].strict)return t[u].swap(!1),void t[u].bubble("reflow");i.createLeftOf.apply(this,arguments)}});r["="]=Be,r["×"]=r.times=h(T,"\\times ","&times;","[x]"),r["÷"]=r.div=r.divide=r.divides=h(T,"\\div ","&divide;","[/]"),Y["~"]=r.sim=h(T,"\\sim ","~","~");var $,qe,Me=L,Fe=document.createElement("div").style;for(var $e in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if($e in Fe){qe=$e;break}qe?$=function(e,i,t){e.css(qe,"scale("+i+","+t+")")}:"filter"in Fe?(Me=function(e){e.className=e.className},$=function(e,i,t){i/=1+(t-1)/2,e.css("fontSize",t+"em"),e.hasClass("mq-matrixed-container")||e.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var n=e.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+i+",SizingMethod='auto expand')");function s(){e.css("marginRight",(n.width()-1)*(i-1)/i+"px")}s();var a=setInterval(s);O(window).load(function(){clearTimeout(a),s()})}):$=function(e,i,t){e.css("fontSize",t+"em")};var ne=d(g,function(e,i){e.init=function(t,n,s){i.init.call(this,t,"<"+n+" "+s+">&0</"+n+">")}});r.mathrm=h(ne,"\\mathrm","span",'class="mq-roman mq-font mq-mathrm"'),r.mathit=h(ne,"\\mathit","i",'class="mq-font"'),r.mathbf=h(ne,"\\mathbf","span",'class="mq-font mq-mathbf"'),r.mathsf=h(ne,"\\mathsf","span",'class="mq-sans-serif mq-font"'),r.mathtt=h(ne,"\\mathtt","span",'class="mq-monospace mq-font"'),r.start=d(g,function(e,i){e.ctrlSeq="\\start ",e.htmlTemplate='<span class="mq-non-leaf"></span>'}),r.LineLine=d(g,function(e,i){e.ctrlSeq="\\LineLine",e.htmlTemplate='<span class="mq-non-leaf" style="margin: 0 1px;"><span style="letter-spacing:-1px">||</span><span>&0</span><span style="letter-spacing:-1px">||</span></span>'}),r.Bracket=d(g,function(e,i){e.ctrlSeq="\\Bracket",e.htmlTemplate='<span class="mq-non-leaf"><span style="letter-spacing:-1px">[[</span><span>&0</span><span style="letter-spacing:-1px">]]</span></span>'}),r.leftlineline=d(g,function(e,i){e.ctrlSeq="\\leftlineline",e.htmlTemplate='<span class="mq-non-leaf"><span>||</span><span>&0</span></span>'}),r.rightlineline=d(g,function(e,i){e.ctrlSeq="\\rightlineline",e.htmlTemplate='<span class="mq-non-leaf"><span>&0</span><span>||</span></span>'}),r.llbracket=d(g,function(e,i){e.ctrlSeq="\\llbracket",e.htmlTemplate='<span class="mq-non-leaf"><span style="letter-spacing:-1px">[[</span><span>&0</span></span>'}),r.rrbracket=d(g,function(e,i){e.ctrlSeq="\\rrbracket",e.htmlTemplate='<span class="mq-non-leaf"><span>&0</span><span style="letter-spacing:-1px">]]</span></span>'}),r.underline=d(g,function(e,i){e.ctrlSeq="\\underline",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span>&0</span><div style="border-top:1px solid;margin-top:1px;"></div></span>'}),r["\\overline{\\overline{}}"]=d(g,function(e,i){e.ctrlSeq="\\overline{\\overline{}}",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div style="border-top:1px solid;margin-bottom:3px;"></div><div style="border-top:1px solid;margin-bottom:5px;"></div><span>&0</span></span>',e.latex=function(){return"\\overline{\\overline{"+this.ends[u].latex()+"}}"}}),r.overline=r.bar=d(g,function(e,i){e.ctrlSeq="\\overline",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div style="border-top:1px solid;margin-bottom:3px;"></div><span>&0</span></span>'}),r.overrightarrow=d(g,function(e,i){e.ctrlSeq="\\overrightarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="mq-overarrow mq-arrow-right"></div><span class="mq-under">&0</span></span>'}),r.overleftarrow=d(g,function(e,i){e.ctrlSeq="\\overleftarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="mq-overarrow mq-arrow-left"></div><span class="mq-under">&0</span></span>'}),r.overfrown=d(g,function(e,i){e.ctrlSeq="\\overfrown",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div style="transform:rotate(90deg);">(</div><span class="mq-under overfrown">&0</span></span>'}),r.oversmile=d(g,function(e,i){e.ctrlSeq="\\oversmile",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div style="transform:rotate(90deg);">)</div><span class="mq-under">&0</span></span>'}),r.overrarrow=d(g,function(e,i){e.ctrlSeq="\\overrarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="my-over">&#8594;</div><span class="mq-under">&0</span></span>'}),r.overlarrow=d(g,function(e,i){e.ctrlSeq="\\overlarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="my-over">&#8592;</div><span class="mq-under">&0</span></span>'}),r.overlrarrow=d(g,function(e,i){e.ctrlSeq="\\overlrarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="my-over">&#8596;</div><span class="mq-under">&0</span></span>'}),r.overrharpoonup=d(g,function(e,i){e.ctrlSeq="\\overrharpoonup",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="my-over">&#8640;</div><span class="mq-under">&0</span></span>'}),r.overlharpoonup=d(g,function(e,i){e.ctrlSeq="\\overlharpoonup",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="my-over">&#8636;</div><span class="mq-under">&0</span></span>'}),r.underrarrow=d(g,function(e,i){e.ctrlSeq="\\underrarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align: text-top;"><span>&0</span><div>&#8594;</div></span>'}),r.underlarrow=d(g,function(e,i){e.ctrlSeq="\\underlarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align: text-top;"><span>&0</span><div>&#8592;</div></span>'}),r.underlrarrow=d(g,function(e,i){e.ctrlSeq="\\underlrarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align: text-top;"><span>&0</span><div>&#8596;</div></span>'}),r.underrharpoonup=d(g,function(e,i){e.ctrlSeq="\\underrharpoonup",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align: text-top;"><span>&0</span><div>&#8640;</div></span>'}),r.underlharpoonup=d(g,function(e,i){e.ctrlSeq="\\underlharpoonup",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align: text-top;"><span>&0</span><div>&#8636;</div></span>'}),r.overleftrightarrow=d(g,function(e,i){e.ctrlSeq="\\overleftrightarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="mq-overarrow mq-arrow-both"></div><span class="mq-under">&0</span></span>',e.textTemplate=[""]}),r.underleftrightarrow=d(g,function(e,i){e.ctrlSeq="\\underleftrightarrow",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><div class="mq-overarrow mq-arrow-both"></div></span>',e.textTemplate=[""]}),r.overparen=d(g,function(e,i){e.ctrlSeq="\\overparen",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><div class="mq-over mq-overparen"></div><span>&0</span></span>'}),r.underrightarrow=d(g,function(e,i){e.ctrlSeq="\\underrightarrow",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><div class="mq-overarrow mq-arrow-right"></div></span>'}),r.underleftarrow=d(g,function(e,i){e.ctrlSeq="\\underleftarrow",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><div class="mq-overarrow mq-arrow-left"></div></span>'}),r.underset=d(g,function(e,i){e.ctrlSeq="\\underset",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span class="mq-over">&1</span><span class="mq-under">&0</span></span>',e.textTemplate=["[","|","]"],e.finalizeTree=function(){this.downInto=this.ends[u].upOutOf=this.ends[1],this.upInto=this.ends[1].downOutOf=this.ends[u]},e.reflow=function(){var t=this.jQ;t.find(".overset-rightleftarrows").length&&t.css("vertical-align","middle"),t.find(".my-overset").length&&t.css("vertical-align","middle")}}),r.overset=d(g,function(e,i){e.ctrlSeq="\\overset",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><span class="mq-over my-overset">&0</span><span class="mq-under">&1</span></span>',e.textTemplate=["[","|","]"],e.deleteTowards=function(t,n){this.downInto,i.deleteTowards.apply(this,arguments)},e.finalizeTree=function(){this.downInto=this.ends[1].upOutOf=this.ends[u],this.upInto=this.ends[u].downOutOf=this.ends[1]}}),r.overllrarrow=d(g,function(e,i){e.ctrlSeq="\\overllrarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><span class="mq-over" style="margin-bottom: -0.3em;">&0</span><span style="font-size: 17px;">&#10231;</span></span>',e.reflow=function(){var t=this.ends[1].jQ.parents();t.length&&t[2]&&t[2].classList.contains("mq-underset")&&(t[2].style.verticalAlign="middle")}}),r.underllrarrow=d(g,function(e,i){e.ctrlSeq="\\underllrarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align: text-top;"><div>&#10231;</div><span class="mq-under">&0</span></span>'}),r.overrightleftarrows=d(g,function(e,i){e.ctrlSeq="\\overrightleftarrows",e.htmlTemplate='<span class="overset-rightleftarrows mq-overset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><span class="mq-under" style="font-size: 18px;">&#8644;</span></span>'}),r.underrightleftarrows=d(g,function(e,i){e.ctrlSeq="\\underrightleftarrows",e.htmlTemplate='<span class="underset-rightleftarrows mq-underset mq-overunder mq-non-leaf"><span class="mq-over" style="font-size: 18px;">&#8644;</span><span class="mq-under">&0</span></span>'}),r.overrightleftharpoons=d(g,function(e,i){e.ctrlSeq="\\overrightleftharpoons",e.htmlTemplate='<span class="overset-rightleftarrows mq-overset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><span class="mq-under" style="font-size: 18px;">&#8651;</span></span>'}),r.underrightleftharpoons=d(g,function(e,i){e.ctrlSeq="\\underrightleftharpoons",e.htmlTemplate='<span class="underset-rightleftarrows mq-underset mq-overunder mq-non-leaf"><span class="mq-over" style="font-size: 18px;">&#8651;</span><span class="mq-under">&0</span></span>'}),r.color=d(g,function(e,i){e.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},e.latex=function(){return"\\color{"+this.color+"}{"+this.blocks[0].latex()+"}"},e.parser=function(){var t=this,n=x.optWhitespace,s=x.string,a=x.regex;return n.then(s("{")).then(a(/^[#\w\s.,()%-]*/)).skip(s("}")).then(function(o){return t.setColor(o),i.parser.call(t)})},e.isStyleBlock=function(){return!0}}),r.boldsymbol=d(g,function(e,i){e.setWeight=function(){this.htmlTemplate='<span class="mq-weight mq-boldsymbol" style="font-weight:700;">&0</span>'},e.latex=function(){return"\\boldsymbol{"+this.blocks[0].latex()+"}"},e.parser=function(){var t=this;return x.optWhitespace.then(function(){return t.setWeight(),i.parser.call(t)})},e.isStyleBlock=function(){return!0}}),r.mathit=d(g,function(e,i){e.setWeight=function(){this.htmlTemplate='<span style="font-weight:normal;">&0</span>'},e.latex=function(){return"\\mathit{"+this.blocks[0].latex()+"}"},e.parser=function(){var t=this;return x.optWhitespace.then(function(){return t.setWeight(),i.parser.call(t)})},e.isStyleBlock=function(){return!0}}),r["\\"]=d(g,function(e,i){e.latex=function(){return"\\\\"},e.parser=function(){return this.htmlTemplate='<span style="display:block;" class="mq-br"></span>>',i.parser.call(this)},e.isStyleBlock=function(){return!0}}),r.class=d(g,function(e,i){e.parser=function(){var t=this,n=x.string,s=x.regex;return x.optWhitespace.then(n("{")).then(s(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(a){return t.cls=a||"",t.htmlTemplate='<span class="mq-class '+a+'">&0</span>',i.parser.call(t)})},e.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},e.isStyleBlock=function(){return!0}});var H=d(g,function(e,i){e.ctrlSeq="_{}^{}",e.createLeftOf=function(t){if(this.replacedFragment||t[u]||!t.options.supSubsRequireOperand)return i.createLeftOf.apply(this,arguments)},e.contactWeld=function(t){for(var n=u;n;n=n===u&&1)if(this[n]instanceof H){for(var s="sub";s;s=s==="sub"&&"sup"){var a=this[s],o=this[n][s];if(a){if(o)if(a.isEmpty())l=M(o,0,o.ends[u]);else{a.jQ.children().insAtDirEnd(-n,o.jQ);var c=a.children().disown(),l=M(o,c.ends[1],o.ends[u]);n===u?c.adopt(o,o.ends[1],0):c.adopt(o,0,o.ends[u])}else this[n].addBlock(a.disown());this.placeCursor=function(p,m){return function(q){q.insAtDirEnd(-n,p||m)}}(o,a)}}this.remove(),t&&t[u]===this&&(n===1&&l?l[u]?t.insRightOf(l[u]):t.insAtLeftEnd(l.parent):t.insRightOf(this[n]));break}},U.p.charsThatBreakOutOfSupSub="",e.finalizeTree=function(){this.ends[u].write=function(t,n){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if(n==="_")return;var s=this.chToCmd(n,t.options);return s instanceof F?t.deleteSelection():t.clearSelection().insRightOf(this.parent),s.createLeftOf(t.show())}t[u]&&!t[1]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(n)>-1&&t.insRightOf(this.parent),Q.p.write.apply(this,arguments)}},e.moveTowards=function(t,n,s){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):i.moveTowards.apply(this,arguments)},e.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var s=this.sub.ends[-t];s instanceof F?s.remove():s&&s.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(u,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else i.deleteTowards.apply(this,arguments)},e.latex=function(){function t(n,s){var a=s&&s.latex();return s?n+"{"+(a||"")+"}":""}return this[-1].ctrlSeq==="\\lbrace "?t("",this.sup)+"\\\\"+t("",this.sub)+"\\\\\\end{cases}":t("_",this.sub)+t("^",this.sup)},e.addBlock=function(t){this.supsub==="sub"?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=O('<span class="mq-sup"/>').append(t.jQ.children()).attr(z,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=O('<span class="mq-sub"></span>').append(t.jQ.children()).attr(z,t.id).appendTo(this.jQ.removeClass("mq-sup-only")));for(var n=0;n<2;n+=1)(function(s,a,o,c){s[a].deleteOutOf=function(l,p){if(p.insDirOf(this[l]?-l:l,this.parent),!this.isEmpty()){var m=this.ends[l];this.children().disown().withDirAdopt(l,p.parent,p[l],p[-l]).jQ.insDirOf(-l,p.jQ),p[-l]=m}s.supsub=o,delete s[a],delete s[c+"Into"],s[o][c+"OutOf"]=be,delete s[o].deleteOutOf,a==="sub"&&O(s.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,"sub sup".split(" ")[n],"sup sub".split(" ")[n],"down up".split(" ")[n])}});function be(e){var i=this.parent,t=e;do{if(t[1])return e.insLeftOf(i);t=t.parent.parent}while(t!==i);e.insRightOf(i)}r.subscript=r._=d(H,function(e,i){e.supsub="sub",e.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["_"],e.finalizeTree=function(){this.downInto=this.sub=this.ends[u],this.sub.upOutOf=be,i.finalizeTree.call(this)}}),r.superscript=r.supscript=r["^"]=d(H,function(e,i){e.supsub="sup",e.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',e.textTemplate=["^"],e.finalizeTree=function(){this.upInto=this.sup=this.ends[1],this.sup.downOutOf=be,i.finalizeTree.call(this)},e.reflow=function(){var t=this.jQ;this.blocks&&this.blocks[0]&&this.blocks[0].latex()=="\\circ "?t.css("vertical-align","0.4em"):t.css("vertical-align","0.5em")}}),r["{}/{}"]=d(H,function(e,i){e.htmlTemplate='<span class="mq-non-leaf"><span>&0</span></span><span>/</span><span class="mq-non-leaf"><span >&1</span></span>',e.textTemplate=["{}/{}"],e.latex=function(){return"{"+this.ends[u].latex()+"}/{"+this.ends[1].latex()+"}"}});var we=d(g,function(e,i){e.init=function(t,n){var s='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+n+'</big><span class="mq-from"><span>&0</span></span></span>';F.prototype.init.call(this,t,s)},e.createLeftOf=function(t){i.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(N("n").createLeftOf(t),Be().createLeftOf(t))},e.latex=function(){function t(n){return n.length===1?n:"{"+(n||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[u].latex())+"^"+t(this.ends[1].latex())},e.parser=function(){for(var t=x.string,n=x.optWhitespace,s=x.succeed,a=j.block,o=this,c=o.blocks=[Q(),Q()],l=0;l<c.length;l+=1)c[l].adopt(o,o.ends[1],0);return n.then(t("_").or(t("^"))).then(function(p){var m=c[p==="_"?0:1];return a.then(function(q){return q.children().adopt(m,m.ends[1],0),s(o)})}).many().result(o)},e.finalizeTree=function(){this.downInto=this.ends[u],this.upInto=this.ends[1],this.ends[u].upOutOf=this.ends[1],this.ends[1].downOutOf=this.ends[u]}});r.sum=h(f,"\\sum ","&sum;"),r["\\sum_{}{}"]=d(g,function(e,i){e.ctrlSeq="\\sum_{}{}",e.htmlTemplate='<span class="mq-non-leaf mq-fraction" style="vertical-align:-0.6em;"><span class="mq-scaled mq-scale mq-paren">&sum;</span><span class="mq-non-leaf"><span style="margin-left:0.4em;">&0</span><span class="mq-adFunction" style="width:10px;">&1</span></span></span>',e.textTemplate=[""],e.latex=function(){return"\\sum_{"+this.ends[1].latex()+"}{"+this.ends[u].latex()+"}"}}),r.xrightarrow=d(g,function(e,i){e.ctrlSeq="\\xrightarrow",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf" style="vertical-align:-0.4em;"><span class="mq-over" style="font-size:0.7em;">&0</span><div class="mq-overarrow mq-arrow-right"></div></span>',e.textTemplate=[""],e.parser=function(){return j.optBlock.then(function(t){return j.block.map(function(n){var s=Xe();return s.blocks=[t,n],t.adopt(s,0,0),n.adopt(s,t,0),s})}).or(i.parser.call(this))}});var Xe=r["\\xrightarrow[]{}"]=d(g,function(e,i){e.ctrlSeq="\\xrightarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align:-0.6em;"><span class="mq-over" style="font-size:0.7em;">&0</span><div class="mq-overarrow mq-arrow-right"></div><span class="mq-overunder mq-underset"><span class="mq-under">&1</span></span></span>',e.textTemplate=[""],e.latex=function(){return"\\xrightarrow["+this.ends[1].latex()+"]{"+this.ends[u].latex()+"}"}});r.overxrightarrow=d(g,function(e,i){e.ctrlSeq="\\overxrightarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align:-0.7em;"><div class="mq-overarrow mq-arrow-right"></div><span class="mq-overunder mq-underset"><span class="mq-under">&0</span></span></span>',e.textTemplate=[""]}),r.underxleftarrow=d(g,function(e,i){e.ctrlSeq="\\underxleftarrow",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align:-0.7em;"><div class="mq-overarrow mq-arrow-left"></div><span class="mq-overunder mq-underset"><span class="mq-under">&0</span></span></span>',e.textTemplate=[""]}),r.xleftarrow=d(g,function(e,i){e.ctrlSeq="\\xleftarrow",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf" style="vertical-align:-0.4em;"><span class="mq-over" style="font-size:0.7em;">&0</span><div class="mq-overarrow mq-arrow-left"></div></span>',e.textTemplate=[""],e.parser=function(){return j.optBlock.then(function(t){return j.block.map(function(n){var s=Je();return s.blocks=[t,n],t.adopt(s,0,0),n.adopt(s,t,0),s})}).or(i.parser.call(this))}});var Je=r["\\xleftarrow[]{}"]=d(g,function(e,i){e.ctrlSeq="\\xleftarrow[]{}",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align:-0.7em;"><span class="mq-over">&0</span><div class="mq-overarrow mq-arrow-left"></div><span class="mq-overunder mq-underset"><span class="mq-under">&1</span></span></span>',e.textTemplate=[""],e.latex=function(){return"\\xleftarrow["+this.ends[1].latex()+"]{"+this.ends[u].latex()+"}"}});r["\\overset{}{\\longleftrightarrow}"]=d(g,function(e,i){e.ctrlSeq="\\overset{}{\\longleftrightarrow}",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf" style="vertical-align:-0.2em;"><span class="mq-over">&0</span><div class="mq-overarrow mq-arrow-both"></div></span>',e.latex=function(){return"\\overset{"+this.ends[u].latex()+"}{\\longleftrightarrow}"}}),r["\\underset{}{\\longleftrightarrow}"]=d(g,function(e,i){e.ctrlSeq="\\underset{}{\\longleftrightarrow}",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf" style="vertical-align:-0.6em;"><div class="mq-overarrow mq-arrow-both"></div><span class="mq-under">&0</span></span>',e.latex=function(){return"\\underset{"+this.ends[u].latex()+"}{\\longleftrightarrow}"}}),r["\\underset{}{\\overset{}{\\longleftrightarrow}}"]=d(g,function(e,i){e.ctrlSeq="\\underset{}{\\overset{}{\\longleftrightarrow}}",e.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf" style="vertical-align:-0.7em;"><span class="mq-over">&0</span><div class="mq-overarrow mq-arrow-both"></div><span class="mq-overunder mq-underset"><span class="mq-under">&1</span></span></span>',e.latex=function(){return"\\underset{"+this.ends[1].latex()+"}{\\overset{"+this.ends[u].latex()+"}{\\longleftrightarrow}}"}}),r["\\overset{}{\\leftrightarrows}"]=d(g,function(e,i){e.ctrlSeq="\\overset{}{\\leftrightarrows}",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf" style="vertical-align:-0.3em;"><span class="mq-over">&0</span><span class="mq-under"><div class="mq-overarrow mq-arrow-right"></div><div class="mq-overarrow mq-arrow-left"></div></span></span>',e.textTemplate=[""],e.latex=function(){return"\\overset{"+this.ends[u].latex()+"}{\\leftrightarrows}"}}),r["\\underset{}{\\leftrightarrows}"]=d(g,function(e,i){e.ctrlSeq="\\underset{}{\\leftrightarrows}",e.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf" style="vertical-align:-0.9em;"><span class="mq-over"><div class="mq-overarrow mq-arrow-right"></div><div class="mq-overarrow mq-arrow-left"></div></span><span class="mq-under">&0</span></span>',e.textTemplate=[""],e.latex=function(){return"\\underset{"+this.ends[u].latex()+"}{\\leftrightarrows}"}}),r.lefttopbox=d(g,function(e,i){e.ctrlSeq="\\lefttopbox",e.htmlTemplate='<span class="mq-left-top-boxed"><span>&0</span></span>',e.textTemplate=[""]}),r.toprightbox=d(g,function(e,i){e.ctrlSeq="\\toprightbox",e.htmlTemplate='<span class="mq-top-right-boxed"><span>&0</span></span>',e.textTemplate=[""]}),r.leftbottombox=d(g,function(e,i){e.ctrlSeq="\\leftbottombox",e.htmlTemplate='<span class="mq-left-bottom-boxed"><span>&0</span></span>',e.textTemplate=[""]}),r.rightbottombox=d(g,function(e,i){e.ctrlSeq="\\rightbottombox",e.htmlTemplate='<span class="mq-right-bottom-boxed"><span>&0</span></span>',e.textTemplate=[""]}),r.boxed=d(g,function(e,i){e.ctrlSeq="\\boxed",e.htmlTemplate='<span class="mq-boxed"><span>&0</span></span>',e.textTemplate=[""]}),r.overcirc=d(g,function(e,i){e.ctrlSeq="\\overcirc",e.htmlTemplate='<span class="mq-overunder mq-overset mq-non-leaf" style="display: inline-block;margin-right: 0.5em;"><span class="mq-overunder mq-underset" style="display: inline-block;"><span class="mq-under" style="font-size: 1em;">&0</span><span class="my-sup">&#8728;</span></span></span>',e.textTemplate=[""]}),r.overprime=d(g,function(e,i){e.ctrlSeq="\\overprime",e.htmlTemplate='<span class="mq-overunder mq-overset mq-non-leaf" style="display: inline-block;"><span class="mq-overunder mq-underset" style="display: inline-block;"><span class="mq-under" style="font-size: 1em;">&0</span><span class="my-sup">&prime;</span></span></span>',e.textTemplate=[""]}),r.overpprime=d(g,function(e,i){e.ctrlSeq="\\overpprime",e.htmlTemplate='<span class="mq-overunder mq-overset mq-non-leaf" style="display: inline-block;margin-right: 0.6em;vertical-align: -0.1em;"><span class="mq-overunder mq-underset" style="display: inline-block;"><span class="mq-under" style="font-size: 1em;">&0</span><span class="my-sup2">&prime;&prime;</span></span></span>',e.textTemplate=[""]}),r.overppprime=d(g,function(e,i){e.ctrlSeq="\\overppprime",e.htmlTemplate='<span class="mq-overunder mq-overset mq-non-leaf" style="margin-right: 0.7em;vertical-align: -0.1em;"><span class="mq-overunder mq-underset" style="display: inline-block;"><span class="mq-under" style="font-size: 1em;">&0</span><span class="my-sup3">&prime;&prime;&prime;</span></span></span>',e.textTemplate=[""]}),r.overbackprime=d(g,function(e,i){e.ctrlSeq="\\overbackprime",e.htmlTemplate='<span class="mq-overunder mq-overset mq-non-leaf" style="margin-left: 0.3em;vertical-align: -0.1em;"><span class="my-back-sup">&#96;</span><span class="mq-overunder mq-underset" style="display: inline-block;"><span class="mq-under" style="font-size: 1em;">&0</span></span></span>',e.textTemplate=[""]}),r.dot=d(g,function(e,i){e.ctrlSeq="\\dot",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-dot-box">&0</span></span></span>',e.textTemplate=[""]}),r.ddot=d(g,function(e,i){e.ctrlSeq="\\ddot",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;&#x2d9;</span><span class="mq-dot-box">&0</span></span></span>',e.textTemplate=[""]}),r.dddot=d(g,function(e,i){e.ctrlSeq="\\dddot",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;&#x2d9;&#x2d9;</span><span class="mq-dot-box">&0</span></span></span>',e.textTemplate=[""]}),r.underdot=d(g,function(e,i){e.ctrlSeq="\\underdot",e.htmlTemplate='<span class="mq-dot-underset mq-non-leaf"><span class="mq-dot-box">&0</span><span class="mq-dot-recurring">&#x2d9;</span></span>',e.textTemplate=[""]}),r.underddot=d(g,function(e,i){e.ctrlSeq="\\underddot",e.htmlTemplate='<span class="mq-dot-underset mq-non-leaf"><span class="mq-dot-box">&0</span><span class="mq-dot-recurring">&#x2d9;&#x2d9;</span></span>',e.textTemplate=[""]}),r.underdddot=d(g,function(e,i){e.ctrlSeq="\\underdddot",e.htmlTemplate='<span class="mq-dot-underset mq-non-leaf"><span class="mq-dot-box">&0</span><span class="mq-dot-recurring">&#x2d9;&#x2d9;&#x2d9;</span></span>',e.textTemplate=[""]});var Ze=r.frac=r.cfrac=r.fraction=d(g,function(e,i){e.ctrlSeq="\\frac",e.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><div  style="border-top:1px solid;"></div><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["(",")/(",")"],e.finalizeTree=function(){this.upInto=this.ends[1].upOutOf=this.ends[u],this.downInto=this.ends[u].downOutOf=this.ends[1]}});r.dfrac=d(g,function(e,i){e.ctrlSeq="\\dfrac",e.htmlTemplate='<span class="mq-fraction mq-non-leaf" style="font-size:100%;"><span class="mq-numerator">&0</span><div style="border-top:1px solid;"></div><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["(",")/(",")"],e.finalizeTree=function(){this.upInto=this.ends[1].upOutOf=this.ends[u],this.downInto=this.ends[u].downOutOf=this.ends[1]}}),r.tfrac=d(g,function(e,i){e.ctrlSeq="\\tfrac",e.htmlTemplate='<span class="mq-fraction mq-non-leaf" style="font-size:70%;"><span class="mq-numerator">&0</span><div style="border-top:1px solid;"></div><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["(",")/(",")"],e.finalizeTree=function(){this.upInto=this.ends[1].upOutOf=this.ends[u],this.downInto=this.ends[u].downOutOf=this.ends[1]}});var et=r.over=d(Ze,function(e,i){e.createLeftOf=function(t){if(!this.replacedFragment){for(var n=t[u];n&&!(n instanceof T||n instanceof(r.text||L)||n instanceof we||n.ctrlSeq==="\\ "||/^[,;:]$/.test(n.ctrlSeq));)n=n[u];n instanceof we&&n[1]instanceof H&&(n=n[1])[1]instanceof H&&n[1].ctrlSeq!=n.ctrlSeq&&(n=n[1]),n!==t[u]&&(this.replaces(D(n[1]||t.parent.ends[u],t[u])),t[u]=n)}i.createLeftOf.call(this,t)}});r["\\overset{}{\\overline{\\left){}\\right.}}"]=d(g,function(e,i){e.ctrlSeq="\\overset{}{\\overline{\\left){}\\right.}}",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-numerator" style="width:20px;font-size:70%;margin-left:12px;">&0</span><span class="math-division">)</span><span class="mq-non-leaf mq-sqrt-stem">&1</span></span>',e.template=[""],e.latex=function(){return"\\overset{"+this.ends[u].latex()+"}{\\overline{\\left){"+this.ends[1].latex()+"}\\right.}}"},e.reflow=function(){var t=this.ends[1].jQ;$(t.prev(),1,t.innerHeight()/+parseFloat(t.css("fontSize").slice(0,-2))+.2)}}),r.vertical=d(g,function(e,i){e.ctrlSeq="\\vertical",e.htmlTemplate='<span class="mq-vertical mq-non-leaf"><div class="mq-vertical-line"><span>)</span><span class="mq-vertical-under">&0</span></div></span>',e.template=[""]}),r["\\overline{\\left){}\\right.}"]=d(g,function(e,i){e.ctrlSeq="\\overline{\\left){}\\right.}",e.htmlTemplate='<span class="mq-non-leaf"><span class="math-division">)</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',e.textTemplate=[""],e.latex=function(){return"\\overline{\\left){"+this.ends[u].latex()+"}\\right.}"},e.reflow=function(){var t=this.ends[1].jQ;$(t.prev(),1,t.innerHeight()/+parseFloat(t.css("fontSize").slice(0,-2))+.2)}}),r.overbrace=d(g,function(e,i){e.ctrlSeq="\\overbrace{}^{}",e.htmlTemplate='<span class="overbrace-box mq-overunder mq-overset mq-non-leaf" style="margin-right:5px;"><span class="mq-over">&1</span><div style="transform:rotate(90deg);">{</div><span class="mq-overunder mq-underset"><span class="mq-under" style="font-size:1em;margin:0;">&0</span></span></span>',e.textTemplate=[""],e.latex=function(){return"\\overbrace{"+this.ends[u].latex()+"}^{"+this.ends[1].latex().substring(1)+"}"}}),r.underbrace=d(g,function(e,i){e.ctrlSeq="\\underbrace{}_{}",e.htmlTemplate='<span class="mq-overunder mq-overset mq-non-leaf" style="vertical-align:-1.86em;margin-right:5px;"><span class="mq-over" style="font-size:1em;margin:0;">&0</span><div style="transform:rotate(270deg);">{</div><span class="mq-overunder mq-underset"><span class="mq-under underbrace-under">&1</span></span></span>',e.textTemplate=[""],e.latex=function(){return"\\underbrace{"+this.ends[u].latex()+"}_{"+this.ends[1].latex().substring(1)+"}"}}),r.not=d(g,function(e,i){e.ctrlSeq="\\not",e.htmlTemplate='<span style="position:relative;top:0;left:0;"><span >&0</span><span style="position:absolute;top:0px;left:3px;transform:scale(1.5,1.5)">/</span></span>',e.textTemplate=["not{","}"],e.latex=function(){return"\\not{"+this.ends[u].latex()+"}"}}),r.sqrt=r["√"]=d(g,function(e,i){e.ctrlSeq="\\sqrt",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',e.textTemplate=["sqrt(",")"],e.parser=function(){return j.optBlock.then(function(t){return j.block.map(function(n){var s=tt();return s.blocks=[t,n],t.adopt(s,0,0),n.adopt(s,t,0),s})}).or(i.parser.call(this))},e.reflow=function(){var t=this.ends[1].jQ;$(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),r.hat=r.widehat=d(g,function(e,i){e.ctrlSeq="\\hat",e.htmlTemplate='<span class="mq-hat mq-non-leaf"><span class="mq-hat-prefix" style="font-family:monospace;">^</span><span class="mq-hat-stem">&0</span></span>',e.textTemplate=["hat(",")"]});var tt=r["\\nthroot"]=d(g,function(e,i){e.ctrlSeq="\\nthroot{}",e.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',e.textTemplate=["sqrt[","](",")"],e.latex=function(){return"\\sqrt["+this.ends[u].latex()+"]{"+this.ends[1].latex()+"}"}}),Pe=d(g,function(e,i){e.init=function(t,n,s){var a='<span class="mq-overset mq-overunder mq-non-leaf"><span class="mq-over"><span class="special mq-undefined-symbol">'+n+'</span></span><span class="mq-under">&0</span></span>';i.init.call(this,t,a,s)}});function Ne(e,i){e.jQadd=function(){i.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},e.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));/^⟨/.test(this.jQ.children(":first").html())||/⟩$/.test(this.jQ.children(":last").html())?$(this.delimjQs,J(1+.2*(t-1),1.2),1.3*t):$(this.delimjQs,J(1+.2*(t-1),1.2),1*t)}}r.vec=h(Pe,"\\vec","&rarr;",["vec(",")"]),r.tilde=r.widetilde=h(Pe,"\\tilde","~",["tilde(",")"]);var le=d(d(g,Ne),function(e,i){e.init=function(t,n,s,a,o){i.init.call(this,"\\left"+a,X,[n,s]),this.side=t,this.sides={},this.sides[u]={ch:n,ctrlSeq:a},this.sides[1]={ch:s,ctrlSeq:o}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===1?" mq-ghost":"")+'">'+this.sides[u].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===u?" mq-ghost":"")+'">'+this.sides[1].ch+"</span></span>",i.html.call(this)},e.latex=function(){return"\\left"+this.sides[u].ctrlSeq+" "+this.ends[u].latex()+"\\right"+this.sides[1].ctrlSeq},e.matchBrack=function(t,n,s){return s instanceof le&&s.side&&s.side!==-n&&(!t.restrictMismatchedBrackets||xe[this.sides[this.side].ch]===s.sides[s.side].ch||{"(":"]","[":")"}[this.sides[u].ch]===s.sides[1].ch)&&s},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===u?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){if(!this.replacedFragment){var n=t.options;if(this.sides[u].ch==="|")var s=this.matchBrack(n,1,t[1])||this.matchBrack(n,u,t[u])||this.matchBrack(n,0,t.parent.parent);else s=this.matchBrack(n,-this.side,t[-this.side])||this.matchBrack(n,-this.side,t.parent.parent)}if(s){var a=this.side=-s.side;this.closeOpposing(s),s===t.parent.parent&&t[a]&&D(t[a],t.parent.ends[a],-a).disown().withDirAdopt(-a,s.parent,s,s[a]).jQ.insDirOf(a,s.jQ),s.bubble("reflow")}else a=(s=this).side,s.replacedFragment?s.side=0:t[-a]&&(s.replaces(D(t[-a],t.parent.ends[-a],a)),t[-a]=0),i.createLeftOf.call(s,t);a===u?t.insAtLeftEnd(s.ends[u]):t.insRightOf(s)},e.placeCursor=L,e.unwrap=function(){this.ends[u].children().disown().adopt(this.parent,this,this[1]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,n,s){var a=this.parent,o=this[t],c=a.ends[t];if(t===this.side)return this.unwrap(),void(o?s.insDirOf(-t,o):s.insAtDirEnd(t,a));var l=s.options,p=!this.side;if(this.side=-t,this.matchBrack(l,t,this.ends[u].ends[this.side])){this.closeOpposing(this.ends[u].ends[this.side]);var m=this.ends[u].ends[t];this.unwrap(),m.siblingCreated&&m.siblingCreated(s.options,t),o?s.insDirOf(-t,o):s.insAtDirEnd(t,a)}else{if(this.matchBrack(l,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(n&&p)return this.unwrap(),void(o?s.insDirOf(-t,o):s.insAtDirEnd(t,a));this.sides[t]={ch:xe[this.sides[this.side].ch],ctrlSeq:xe[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost")}o?(m=this.ends[u].ends[t],D(o,c,-t).disown().withDirAdopt(-t,this.ends[u],m,0).jQ.insAtDirEnd(t,this.ends[u].jQ.removeClass("mq-empty")),m.siblingCreated&&m.siblingCreated(s.options,t),s.insDirOf(-t,o)):n?s.insDirOf(t,this):s.insAtDirEnd(t,this.ends[u])}},e.deleteTowards=function(t,n){this.deleteSide(-t,!1,n)},e.finalizeTree=function(){this.ends[u].deleteOutOf=function(t,n){this.parent.deleteSide(t,!0,n)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===u?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,n){n===-this.side&&this.finalizeTree()}}),xe={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "};r.lVert=h(f,"\\lVert","||"),r.rVert=h(f,"\\rVert","||"),r.langle=h(f,"\\langle","⟨"),r.rangle=h(f,"\\rangle","⟩"),r.left=d(g,function(e){e.parser=function(){var i=x.regex,t=x.string,n=(x.succeed,x.optWhitespace);return n.then(i(/^(?:[\]\.\)([|]|\\\{|\\\||\\langle|\\lVert\b)/)).then(function(s){var a=s.charAt(0)==="\\"?s.slice(1):s;return s=="."&&(a="",s+=" "),s=="\\langle"&&(a="&lang;",s+=" "),s=="\\lVert"&&(a="||",s+=" "),j.then(function(o){return t("\\right").skip(n).then(i(/^(?:[\[\]\.)|]|\\\}|\\rangle|\\rVert\b)/)).map(function(c){var l=c.charAt(0)==="\\"?c.slice(1):c;c=="."&&(l="",c+=" "),c=="\\rangle"&&(l="&rang;",c+=" "),c=="\\rVert"&&(l="||",c+=" ");var p=le(0,a,l,s,c);return p.blocks=[o],o.adopt(p,0,0),p})})})}}),r.right=d(g,function(e){e.parser=function(){return x.fail("unmatched \\right")}});var nt=r.binom=r.binomial=d(d(g,Ne),function(e,i){e.ctrlSeq="\\binom",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',e.textTemplate=["choose(",",",")"]});r.choose=d(nt,function(e){e.createLeftOf=et.prototype.createLeftOf}),r.editable=r.MathQuillMathField=d(g,function(e,i){e.ctrlSeq="\\MathQuillMathField",e.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',e.parser=function(){var t=this,n=x.string,s=x.regex,a=x.succeed;return n("[").then(s(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(o){t.name=o}).or(a()).then(i.parser.call(t))},e.finalizeTree=function(t){var n=R(this.ends[u],this.jQ,t);n.KIND_OF_MQ="MathField",n.editable=!0,n.createTextarea(),n.editablesTextareaEvents(),n.cursor.insAtRightEnd(n.root),_e(n.root)},e.registerInnerField=function(t,n){t.push(t[this.name]=n(this.ends[u].controller))},e.latex=function(){return this.ends[u].latex()},e.text=function(){return this.ends[u].text()}});var st=r.embed=d(F,function(e,i){e.setOptions=function(t){function n(){return""}return this.text=t.text||n,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||n,this},e.parser=function(){var t=this,n=x.string,s=x.regex,a=x.succeed;return n("{").then(s(/^[a-z][a-z0-9]*/i)).skip(n("}")).then(function(o){return n("[").then(s(/^[-\w\s]*/)).skip(n("]")).or(a()).map(function(c){return t.setOptions(je[o](c))})})}}),B={};r.begin=d(g,function(e,i){e.parser=function(){var t=x.string,n=x.regex;return t("{").then(n(/^[a-z]+/i)).skip(t("}")).then(function(s){return(B[s]?B[s]().parser():x.fail("unknown environment type: "+s)).skip(t("\\end{"+s+"}"))})}});var rt=d(g,function(e,i){e.template=[["\\begin{","}"],["\\end{","}"]],e.wrappers=function(){return[e.template[0].join(this.environment),e.template[1].join(this.environment)]}}),it=d(g,function(e,i){e.template=[["\\begin{","}{c} "],[" \\end{","}"]],e.wrappers=function(t){return t=t||"",e.template[0][1]="}{"+t+"} ",[e.template[0].join(this.environment),e.template[1].join(this.environment)]}}),se=B.matrix=d(rt,function(e,i){var t="&",n="\\\\";e.parentheses={left:null,right:null},e.environment="matrix",e.reflow=function(){var s=this.jQ.children("table"),a=s.outerHeight()/+s.css("fontSize").slice(0,-2),o=this.jQ.children(".mq-paren");o.length&&$(o,J(1+.2*(a-1),1.2),1.05*a)},e.latex=function(){var s,a="";return this.eachChild(function(o){s!==void 0&&(a+=s!==o.row?n:t),s=o.row,a+=o.latex()}),this.wrappers().join(a)},e.html=function(){var s,a=[],o="",c=0;function l(p){return p?'<span class="mq-scaled mq-paren">'+p+"</span>":""}return this.eachChild(function(p){s!==p.row&&(s=p.row,o+="<tr>$tds</tr>",a[s]=[]),a[s].push('<td class="">&'+c+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+l(this.parentheses.left)+'<table class="mq-non-leaf" cellspacing="10">'+o.replace(/\$tds/g,function(){return a.shift().join("")})+"</table>"+l(this.parentheses.right)+"</span>",i.html.call(this)},e.createBlocks=function(){this.blocks=[_(0,this),_(0,this),_(1,this),_(1,this)]},e.parser=function(){var s=this,a=x.optWhitespace,o=x.string;return a.then(o(t).or(o(n)).or(j.block)).many().skip(a).then(function(c){var l=[],p=0;function m(){s.blocks.push(_(p,s,l)),l=[]}s.blocks=[];for(var q=0;q<c.length;q+=1)c[q]instanceof Q?l.push(c[q]):(m(),c[q]===n&&(p+=1));return m(),s.autocorrect(),x.succeed(s)})},e.finalizeTree=function(){var s=this.jQ.find("table");s.toggleClass("mq-rows-1",s.find("tr").length===1),this.relink()},e.getEntryPoint=function(s,a,o){return o==="up"?s===u?this.blocks[this.rowSize-1]:this.blocks[0]:s===u?this.blocks[this.blocks.length-1]:this.blocks[this.blocks.length-this.rowSize]},e.atExitPoint=function(s,a){var o=this.blocks.indexOf(a.parent);return s===u?o%this.rowSize==0:(o+1)%this.rowSize==0},e.moveTowards=function(s,a,o){var c=o&&this.getEntryPoint(s,a,o);a.insAtDirEnd(-s,c||this.ends[-s])},e.relink=function(){var s,a,o,c=this.blocks,l=[];this.rowSize=c.length;for(var p=0;p<c.length;p+=1)s!==(o=c[p]).row&&(o.row===1&&(this.rowSize=a),l[s=o.row]=[],a=0),l[s][a]=o,o[1]=c[p+1],o[u]=c[p-1],l[s-1]&&l[s-1][a]&&(o.upOutOf=l[s-1][a],l[s-1][a].downOutOf=o),a+=1;this.ends[u]=c[0],this.ends[1]=c[c.length-1]},e.autocorrect=function(s){var a,o,c,l,p,m=[],q=(s=[],this.blocks);for(p=0;p<q.length;p+=1)s[l=q[p].row]=s[l]||[],s[l].push(q[p]),m[l]=s[l].length;if((a=Math.max.apply(null,m))!==Math.min.apply(null,m)){for(p=0;p<s.length;p+=1)for(o=a-s[p].length;o;)c=a*p+s[p].length,q.splice(c,0,_(p,this)),o-=1;this.relink()}},e.deleteCell=function(s){var a,o,c=[],l=[],p=[],m=[],q=this.blocks;function w(v){for(var y=[],k=0;k<v.length;k+=1)v[k].isEmpty()&&y.push(v[k]);return y.length===v.length}function b(v){for(var y=0;y<v.length;y+=1)q.indexOf(v[y])>-1&&(v[y].remove(),q.splice(q.indexOf(v[y]),1))}this.eachChild(function(v){a!==v.row&&(a=v.row,c[a]=[],o=0),l[o]=l[o]||[],l[o].push(v),c[a].push(v),v===s&&(p=c[a],m=l[o]),o+=1}),w(p)&&m.length>1&&(a=c.indexOf(p),this.eachChild(function(v){v.row>a&&(v.row-=1)}),b(p),this.jQ.find("tr").eq(a).remove()),w(m)&&p.length>1&&b(m),this.finalizeTree()},e.addRow=function(s){var a,o,c=[],l=[],p=[],m=O("<tr></tr>"),q=s.row,w=0;this.eachChild(function(v){v.row<=q&&c.push(v),v.row===q&&(v===s&&(o=w),w+=1),v.row>q&&(v.row+=1,p.push(v))});for(var b=0;b<w;b+=1)(a=_(q+1)).parent=this,l.push(a),a.jQ=O('<td class="mq-empty">').attr(z,a.id).appendTo(m);return this.jQ.find("tr").eq(q).after(m),this.blocks=c.concat(l,p),l[o]},e.addColumn=function(s){var a,o,c=[],l=[];this.eachChild(function(m){c[m.row]=c[m.row]||[],c[m.row].push(m),m===s&&(a=c[m.row].length)});for(var p=0;p<c.length;p+=1)(o=_(p)).parent=this,l.push(o),c[p].splice(a,0,o),o.jQ=O('<td class="mq-empty">').attr(z,o.id);return this.jQ.find("tr").each(function(m){O(this).find("td").eq(a-1).after(c[m][a].jQ)}),this.blocks=[].concat.apply([],c),l[s.row]},e.insert=function(s,a){var o=this[s](a);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(o)},e.backspace=function(s,a,o,c){var l=s[a];if(s.isEmpty()){for(this.deleteCell(s);l&&l[a]&&this.blocks.indexOf(l)===-1;)l=l[a];l&&o.insAtDirEnd(-a,l),this.blocks.length===1&&this.blocks[0].isEmpty()&&(c(),this.finalizeTree()),this.bubble("edited")}}});B.array=d(it,function(e,i){var t={column:"&",row:"\\\\",alignResult:""};e.parentheses={left:null,right:null},e.environment="array",e.reflow=function(){var n=this.jQ.children("table"),s=n.outerHeight()/+n.css("fontSize").slice(0,-2),a=this.jQ.children(".mq-paren");a.length&&$(a,J(1+.2*(s-1),1.2),1.05*s)},e.latex=function(){var n,s="";return this.eachChild(function(a){n!==void 0&&(s+=n!==a.row?t.row:t.column),n=a.row,s+="{"+a.latex()+"}"}),this.wrappers(t.alignResult).join(s)},e.html=function(){var n,s=[],a="",o=0;function c(l){return l?'<span class="mq-scaled mq-paren">'+l+"</span>":""}return this.eachChild(function(l){n!==l.row&&(n=l.row,a+="<tr>$tds</tr>",s[n]=[]),s[n].push('<td class="">&'+o+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+c(this.parentheses.left)+'<table class="mq-non-leaf" cellspacing="10">'+a.replace(/\$tds/g,function(){return s.shift().join("")})+"</table>"+c(this.parentheses.right)+"</span>",i.html.call(this)},e.createBlocks=function(){this.blocks=[_(0,this),_(0,this),_(1,this),_(1,this)]},e.parser=function(){var n=this,s=x.optWhitespace,a=x.string;return s.then(a(t.column).or(a(t.row)).or(j.block)).many().skip(s).then(function(o){var c=[],l=0;function p(){n.blocks.push(_(l,n,c)),c=[]}n.blocks=[],t.alignResult=o[0].ends[1].ctrlSeq;for(var m=1;m<o.length;m+=1)o[m]instanceof Q?c.push(o[m]):(p(),o[m]===t.row&&(l+=1));return p(),n.autocorrect(),x.succeed(n)})},e.finalizeTree=function(){var n=this.jQ.find("table");n.toggleClass("mq-rows-1",n.find("tr").length===1),this.relink()},e.getEntryPoint=function(n,s,a){return a==="up"?n===u?this.blocks[this.rowSize-1]:this.blocks[0]:n===u?this.blocks[this.blocks.length-1]:this.blocks[this.blocks.length-this.rowSize]},e.atExitPoint=function(n,s){var a=this.blocks.indexOf(s.parent);return n===u?a%this.rowSize==0:(a+1)%this.rowSize==0},e.moveTowards=function(n,s,a){var o=a&&this.getEntryPoint(n,s,a);s.insAtDirEnd(-n,o||this.ends[-n])},e.relink=function(){var n,s,a,o=this.blocks,c=[];this.rowSize=o.length;for(var l=0;l<o.length;l+=1)n!==(a=o[l]).row&&(a.row===1&&(this.rowSize=s),c[n=a.row]=[],s=0),c[n][s]=a,a[1]=o[l+1],a[u]=o[l-1],c[n-1]&&c[n-1][s]&&(a.upOutOf=c[n-1][s],c[n-1][s].downOutOf=a),s+=1;this.ends[u]=o[0],this.ends[1]=o[o.length-1]},e.autocorrect=function(n){var s,a,o,c,l,p=[],m=(n=[],this.blocks);for(l=0;l<m.length;l+=1)n[c=m[l].row]=n[c]||[],n[c].push(m[l]),p[c]=n[c].length;if((s=Math.max.apply(null,p))!==Math.min.apply(null,p)){for(l=0;l<n.length;l+=1)for(a=s-n[l].length;a;)o=s*l+n[l].length,m.splice(o,0,_(l,this)),a-=1;this.relink()}},e.deleteCell=function(n){var s,a,o=[],c=[],l=[],p=[],m=this.blocks;function q(b){for(var v=[],y=0;y<b.length;y+=1)b[y].isEmpty()&&v.push(b[y]);return v.length===b.length}function w(b){for(var v=0;v<b.length;v+=1)m.indexOf(b[v])>-1&&(b[v].remove(),m.splice(m.indexOf(b[v]),1))}this.eachChild(function(b){s!==b.row&&(s=b.row,o[s]=[],a=0),c[a]=c[a]||[],c[a].push(b),o[s].push(b),b===n&&(l=o[s],p=c[a]),a+=1}),q(l)&&p.length>1&&(s=o.indexOf(l),this.eachChild(function(b){b.row>s&&(b.row-=1)}),w(l),this.jQ.find("tr").eq(s).remove()),q(p)&&l.length>1&&w(p),this.finalizeTree()},e.addRow=function(n){var s,a,o=[],c=[],l=[],p=O("<tr></tr>"),m=n.row,q=0;this.eachChild(function(b){b.row<=m&&o.push(b),b.row===m&&(b===n&&(a=q),q+=1),b.row>m&&(b.row+=1,l.push(b))});for(var w=0;w<q;w+=1)(s=_(m+1)).parent=this,c.push(s),s.jQ=O('<td class="mq-empty">').attr(z,s.id).appendTo(p);return this.jQ.find("tr").eq(m).after(p),this.blocks=o.concat(c,l),c[a]},e.addColumn=function(n){var s,a,o=[],c=[];this.eachChild(function(p){o[p.row]=o[p.row]||[],o[p.row].push(p),p===n&&(s=o[p.row].length)});for(var l=0;l<o.length;l+=1)(a=_(l)).parent=this,c.push(a),o[l].splice(s,0,a),a.jQ=O('<td class="mq-empty">').attr(z,a.id);return this.jQ.find("tr").each(function(p){O(this).find("td").eq(s-1).after(o[p][s].jQ)}),this.blocks=[].concat.apply([],o),c[n.row]},e.insert=function(n,s){var a=this[n](s);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(a)},e.backspace=function(n,s,a,o){var c=n[s];if(n.isEmpty()){for(this.deleteCell(n);c&&c[s]&&this.blocks.indexOf(c)===-1;)c=c[s];c&&a.insAtDirEnd(-s,c),this.blocks.length===1&&this.blocks[0].isEmpty()&&(o(),this.finalizeTree()),this.bubble("edited")}}}),B.cases=d(B.array,function(e,i){e.environment="cases",e.parentheses={left:"{",right:""}}),B.pmatrix=d(se,function(e,i){e.environment="pmatrix",e.parentheses={left:"(",right:")"}}),B.bmatrix=d(se,function(e,i){e.environment="bmatrix",e.parentheses={left:"[",right:"]"}}),B.Bmatrix=d(se,function(e,i){e.environment="Bmatrix",e.parentheses={left:"{",right:"}"}}),B.vmatrix=d(se,function(e,i){e.environment="vmatrix",e.parentheses={left:"|",right:"|"}}),B.Vmatrix=d(se,function(e,i){e.environment="Vmatrix",e.parentheses={left:"&#8214;",right:"&#8214;"}});var _=d(Q,function(e,i){e.init=function(t,n,s){if(i.init.call(this),this.row=t,n&&this.adopt(n,n.ends[1],0),s)for(var a=0;a<s.length;a++)s[a].children().adopt(this,this.ends[1],0)},e.keystroke=function(t,n,s){switch(t){case"Shift-Spacebar":return n.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return i.keystroke.apply(this,arguments)},e.deleteOutOf=function(t,n){var s=this,a=arguments;this.parent.backspace(this,t,n,function(){return i.deleteOutOf.apply(s,a)})},e.moveOutOf=function(t,n,s){!(s&&this.parent.atExitPoint(t,n))&&this[t]?n.insAtDirEnd(-t,this[t]):n.insDirOf(t,this.parent)}}),ye=ae(1);for(var We in ye)(function(e,i){typeof i=="function"?(E[e]=function(){return me(),i.apply(this,arguments)},E[e].prototype=i.prototype):E[e]=i})(We,ye[We])})();
